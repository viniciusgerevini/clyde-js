{"version":3,"sources":["redux/interface.js","redux/editor.js","redux/interpreter.js","redux/reducers.js","screens/SplitPane.js","screens/DropdownMenu.js","editor/clyde-ace-mode.js","editor/Editor.js","../../interpreter/src/logic_interpreter.js","../../interpreter/src/memory.js","../../interpreter/src/events.js","../../parser/src/lexer.js","../../parser/src/nodes.js","../../parser/src/parser.js","interpreter/Bubbles.js","interpreter/InterpreterToolbar.js","interpreter/DialogueEntry.js","interpreter/InterpreterTimeline.js","interpreter/DebugPane.js","interpreter/Interpreter.js","../../interpreter/src/interpreter.js","screens/Modal.js","editor/EditorSettingsModal.js","screens/MainPanels.js","screens/MainPanelsContainer.js","storage/local-storage.js","App.js","WebsiteApp.js","index.js"],"names":["toggleEditor","createAction","toggleInterpreter","changeInterpreterSplitDirection","interfaceReducers","createReducer","isEditorEnabled","isInterpreterEnabled","interpreterSplitDirection","state","action","payload","direction","setDocumentContent","updatePreference","editorReducers","currentValue","preferences","theme","fontSize","tabSize","highlightActiveLine","lineWrap","useSoftTabs","showInvisibles","scrollPastEnd","vimMode","name","value","setBlock","addDialogueLine","clearTimeline","showExtraMetadata","hideExtraMetadata","showDebugPane","hideDebugPane","enableSingleBubbleDialogue","disableSingleBubbleDialogue","chooseOption","notifyEvent","clearEvents","interpreterReducers","currentBlock","undefined","timeline","shouldShowExtraMetadata","shouldShowDebugPane","singleBubblePresentation","document","events","_action","length","type","selected","combineReducers","interfaceConfig","editor","interpreter","Wrapper","styled","div","props","Gutter","SplitPane","defaultSizes","style","children","Array","isArray","visibleChildren","filter","item","sizes","map","s","spaceUsed","reduce","acc","index","indexOf","lastIndex","size","Math","floor","fill","calculateSizes","panes","visibleIndex","push","React","cloneElement","key","flexBasis","flexGrow","ItemWrapper","DropDownMenu","onClick","Children","toArray","DropDownItem","label","icon","text","ClydeHighlightRules","literals","token","regex","logicalOperators","logicBlockEnd","next","logicBlockConstants","identifiers","this","$rules","logicBlock","assignmentBlock","eventBlock","normalizeRules","EditorWrapper","defaultConfig","Editor","defaultValue","notifyChange","useResizeObserver","ref","width","height","mode","onBeforeLoad","ace","define","acequire","exports","oop","TextHighlightRules","inherits","TextMode","Mode","HighlightRules","ClydeMode","$id","lineCommentStart","getNextLineIndent","line","tab","indent","$getIndent","tokens","getTokenizer","getLineTokens","match","onChange","editorProps","$blockScrolling","debounceChangePeriod","keyboardHandler","setOptions","showPrintMargin","wrapBehavioursEnabled","wrap","navigateWithinSoftTabs","LogicInterpreter","mem","expressionHandlers","cond","getNodeValue","elements","checkCondition","Error","conditionHandlers","condition","checkExpression","checkVariable","operationHandlers","setVariable","getVariable","_n","_v","a","operation","nodeValueHandlers","node","handleAssignement","assignment","variable","source","SPECIAL_VARIABLE_NAMES","Memory","listeners","init","access","variables","internal","setAsAccessed","id","wasAlreadyAccessed","includes","getInternalVariable","triggerEvent","VARIABLE_CHANGED","previousValue","setInternalVariable","getAll","load","data","clear","EVENT_TRIGGERED","Events","forEach","l","addListener","callback","removeListener","splice","TOKENS","MODES","tokenFriendlyHint","getTokenFriendlyHint","hint","tokenize","input","position","column","pendingTokens","modes","currentQuote","stackMode","unshift","popMode","shift","isCurrentMode","checkSequence","string","initialPosition","slice","handleQText","initialLine","initialColumn","currentChar","Token","join","trim","optionTypes","keywords","handleLogicDescriptiveOperator","toLowerCase","handleLogicOperator","createSimpleToken","handleLogicBlock","handleLogicString","linebreak","getFollowingLineBreak","handleLogicBlockStop","handleLogicNot","values","handleLogicNumber","handleLogicIdentifier","lookupPosition","lookupColumn","getLeadingLineBreak","getNextToken","handleComments","handleLineBreaks","indentation","previousIndent","handleIndent","handleLogicBlockStart","response","handleSpace","handleStartVariations","handleStopVariations","handleBlock","handleDivert","handleDivertToParent","handleVariationItem","handleOption","handleOptionDisplayChar","handleLineId","handleTag","handleText","concat","DocumentNode","content","blocks","ContentNode","LineNode","speaker","tags","DivertNode","target","VariableNode","LiteralNode","ConditionalContentNode","conditions","ActionContentNode","ExpressionNode","AssignmentNode","EventNode","variationsModes","operators","precedence","associative","assignmentOperators","parse","doc","currentToken","lookaheadTokens","isMultilineEnabled","wrongTokenError","expected","consume","lookahead","peek","offset","Blocks","blockName","Lines","lines","acceptableNext","tk","Line","LineWithAction","Options","Divert","Variations","ConditionalLine","DialogueLine","LineWithSpeaker","TextLine","LineWithMetadata","options","nextLine","LineWithId","LineWithTags","Option","optionType","mainItem","root","wrapper","includeLabelAsContent","block","NestedLogicBlocks","LogicBlock","divert","variations","VariationsNode","startsNextLine","lastVariation","expression","LogicElement","Assignments","Condition","assignments","AssignmentExpression","AssignmentsNode","EventsNode","Expression","Object","keys","minPrecedence","operatorTokens","lhs","Operand","operator","nextMinPrecedence","rhs","Operator","Number","StringLiteralNode","BooleanLiteralNode","labels","result","Document","InfoBubble","ErrorBubble","InterpreterToolbarWrapper","InterpreterToolbar","properties","dialogue","forwardToNextOption","getContent","BlockList","onBlockSelected","start","faRedoAlt","title","faFastForward","faGhost","poltergeist","optionList","choice","random","choose","faHandSparkles","clearData","faComments","faComment","faReceipt","faBug","list","b","event","option","DialogueBubble","DialogueContent","DialogueSpeaker","DialogueOptionsList","ol","DialogueOption","li","p","optionSelected","DialogueMetadataWrapper","span","DialogueEntry","onSelection","showMetadata","DialogueOptions","DialogueMetadata","isVisible","e","stopPropagation","select","InterpreterScreenWrapper","InterpreterTimeline","scrollableRef","useRef","useEffect","current","scrollIntoView","behavior","DebugPaneWrapper","DebugPaneCloseButton","DebugEntryTable","table","DebugPane","entries","identifier","record","eventTime","formatDate","timestamp","date","Date","getFullYear","getMonth","getDate","toLocaleTimeString","faTimes","entry","toString","Interpreter","errorMessage","debugPaneDirection","clydeDocument","useState","lastContent","setLastContent","persistedDialogue","setDialogue","updateDebugInfo","now","stack","textDictionary","anchors","logic","_index","initializeStack","contentIndex","nodeHandlers","handleDocumentNode","handleContentNode","handleOptionsNode","handleOptionNode","handleLineNode","handleActionContent","fallback","handleConditionalContent","handleVariations","handleBlockNode","handleAssignementNode","handleEventNode","variationHandlers","SHUFFLE_VISITED_KEY","LAST_VISITED_KEY","visitedItems","remainingOptions","handleNextNode","generateIndex","stackHead","addToStack","contentNode","pop","optionsNode","getVisibleOptions","selectOption","replaceVariables","translateText","t","_optionNode","attempt","c","lineNode","actionNode","handleAction","conditionalNode","fallbackNode","prepareOption","replace","on","eventName","off","getData","loadData","loadDictionary","dictionary","ClydeInterpreter","message","backgroundColor","ModalWrapper","ModalInnerWrapper","ModalHeader","ModalFooter","ModalContent","ModalAction","button","Modal","actions","Preference","EditorSettingsModal","onCloseClick","update","checked","updateNumber","htmlFor","max","min","Header","IconWrapper","connect","editorDefaultValue","editorPreferences","dispatch","optionIndex","updateEditorPreference","isMenuVisible","setMenuVisibility","isEditorSettingsVisible","setEditorSettingsVisibility","toggleMenu","faCog","faColumns","faCode","faEye","faSlidersH","APP_LOCAL_STORAGE_KEY","store","configureStore","reducer","devTools","process","preloadedState","persistedSate","localStorage","getItem","JSON","_e","loadState","subscribe","throttle","getState","setItem","stringify","saveState","App","MainPanelsContainer","Title","h1","AboutBlock","AboutContent","WebsiteApp","href","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.248340bc.chunk.js","sourcesContent":["import { createAction, createReducer } from \"@reduxjs/toolkit\";\n\nexport const toggleEditor = createAction('editor/interface/toggle_editor');\nexport const toggleInterpreter = createAction('editor/interface/toggle_intepreter');\nexport const changeInterpreterSplitDirection = createAction('editor/interface/change_interpreter_split_direction');\n\nexport function createEmptyState() {\n  return {\n    isEditorEnabled: true,\n    isInterpreterEnabled: true,\n    interpreterSplitDirection: 'vertical'\n  };\n}\n\nconst toggleEditorReducer = (state, action) => {\n  state.isEditorEnabled = action.payload.state;\n  return state;\n};\n\nconst toggleInterpreterReducer = (state, action) => {\n  state.isInterpreterEnabled = action.payload.state;\n  return state;\n};\n\nconst changeInterpreterSplitDirectionReducer = (state, action) => {\n  state.interpreterSplitDirection = action.payload.direction;\n  return state;\n};\n\nconst interfaceReducers = createReducer(createEmptyState(), {\n  [toggleEditor]: toggleEditorReducer,\n  [toggleInterpreter]: toggleInterpreterReducer,\n  [changeInterpreterSplitDirection]: changeInterpreterSplitDirectionReducer,\n});\n\nexport default interfaceReducers;\n","import { createAction, createReducer } from \"@reduxjs/toolkit\";\n\nexport const setDocumentContent = createAction('editor/editor/set_document_content');\nexport const updatePreference = createAction('editor/editor/update_preference');\n\nexport function createEmptyState() {\n  return {\n    currentValue: '',\n    preferences: {\n      theme: 'dracula',\n      fontSize: 16,\n      tabSize: 4,\n      highlightActiveLine: false,\n      lineWrap: false,\n      useSoftTabs: true,\n      showInvisibles: false,\n      scrollPastEnd: false,\n      vimMode: false,\n    }\n  };\n}\n\nconst setDocumentContentReducer = (state, action) => {\n  state.currentValue = action.payload;\n  return state;\n};\n\nconst updatePreferenceReducer = (state, action) => {\n  state.preferences[action.payload.name] = action.payload.value;\n  return state;\n};\n\nconst editorReducers = createReducer(createEmptyState(), {\n  [setDocumentContent]: setDocumentContentReducer,\n  [updatePreference]: updatePreferenceReducer,\n});\n\nexport default editorReducers;\n","import { createAction, createReducer } from \"@reduxjs/toolkit\";\n\nexport const setBlock = createAction('editor/interpreter/set_dialogue_block');\nexport const addDialogueLine = createAction('editor/interpreter/add_dialogue_line');\nexport const clearTimeline = createAction('editor/interpreter/clear_timeline');\nexport const showExtraMetadata = createAction('editor/interpreter/show_metadata');\nexport const hideExtraMetadata = createAction('editor/interpreter/hide_metadata');\nexport const showDebugPane = createAction('editor/interpreter/show_debug_pane');\nexport const hideDebugPane = createAction('editor/interpreter/hide_debug_pane');\nexport const enableSingleBubbleDialogue = createAction('editor/interpreter/enable_single_bubble_dialogue');\nexport const disableSingleBubbleDialogue = createAction('editor/interpreter/disable_single_bubble_dialogue');\nexport const chooseOption = createAction('editor/interpreter/choose_option');\nexport const notifyEvent = createAction('editor/interpreter/notify_event');\nexport const clearEvents = createAction('editor/interpreter/clear_events');\n\n\nexport function createEmptyState() {\n  return {\n    currentBlock: undefined,\n    timeline: [],\n    shouldShowExtraMetadata: false,\n    shouldShowDebugPane: false,\n    singleBubblePresentation: false,\n    document: undefined,\n    events: []\n  };\n}\n\nconst setBlockReducer = (state, action) => {\n  state.currentBlock = action.payload;\n  return state;\n};\n\nconst addDialogueLineReducer = (state, action) => {\n  state.timeline = [...state.timeline, action.payload];\n  return state;\n};\n\nconst clearTimelineReducer = (state, _action) => {\n  state.timeline = [];\n  return state;\n};\n\nconst showExtraMetadataReducer = (state) => {\n  state.shouldShowExtraMetadata = true;\n  return state;\n};\n\nconst hideExtraMetadataReducer = (state) => {\n  state.shouldShowExtraMetadata = false;\n  return state;\n};\n\nconst showDebugPaneReducer = (state) => {\n  state.shouldShowDebugPane = true;\n  return state;\n};\n\nconst hideDebugPaneReducer = (state) => {\n  state.shouldShowDebugPane = false;\n  return state;\n};\n\nconst enableSingleBubbleDialogueReducer = (state) => {\n  state.singleBubblePresentation = true;\n  return state;\n};\n\nconst disableSingleBubbleDialogReducer = (state) => {\n  state.singleBubblePresentation = false;\n  return state;\n};\n\nconst chooseOptionReducer = (state, action) => {\n  if (!state.timeline.length || state.timeline[state.timeline.length -1].type !== 'options') {\n    return state;\n  }\n  state.timeline[state.timeline.length -1].selected = action.payload;\n  return state;\n};\n\nconst notifyEventReducer = (state, action) => {\n  state.events = [...state.events, action.payload];\n  return state;\n};\n\nconst clearEventsReducer = (state, _action) => {\n  state.events = [];\n  return state;\n};\n\nconst interpreterReducers = createReducer(createEmptyState(), {\n  [setBlock]: setBlockReducer,\n  [addDialogueLine]: addDialogueLineReducer,\n  [clearTimeline]: clearTimelineReducer,\n  [showExtraMetadata]: showExtraMetadataReducer,\n  [hideExtraMetadata]: hideExtraMetadataReducer,\n  [showDebugPane]: showDebugPaneReducer,\n  [hideDebugPane]: hideDebugPaneReducer,\n  [enableSingleBubbleDialogue]: enableSingleBubbleDialogueReducer,\n  [disableSingleBubbleDialogue]: disableSingleBubbleDialogReducer,\n  [chooseOption]: chooseOptionReducer,\n  [notifyEvent]: notifyEventReducer,\n  [clearEvents]: clearEventsReducer,\n});\n\nexport default interpreterReducers;\n","import { combineReducers } from 'redux';\nimport interfaceConfig from './interface';\nimport editor from './editor';\nimport interpreter from './interpreter';\n\nexport default combineReducers({\n  interfaceConfig,\n  editor,\n  interpreter\n});\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nconst GUTTER_SIZE = 4;\n\nconst Wrapper = styled.div`\n  display: flex;\n  align-items: stretch;\n  flex-grow: 1;\n  height: auto;\n  flex-direction: ${props => props.direction === 'horizontal' ? 'column' : 'row' };\n  max-height: 100%;\n`;\n\nconst Gutter = styled.div`\n  background-color: #eee;\n  background-repeat: no-repeat;\n  background-position: 50%;\n  flex-basis: ${GUTTER_SIZE}px;\n  cursor: ${props => props.direction === 'horizontal' ? 'row-resize' : 'col-resize' };\n`;\n// TODO\n// - gutter drag resize\n// - make sure sizes are kept when items disappear\n\nexport default function SplitPane(props) {\n  const {\n    direction = 'vertical',\n    defaultSizes,\n    style\n  } = props;\n\n  const children = Array.isArray(props.children) ? props.children : [props.children];\n\n  const visibleChildren = children.filter(item => item && item !== '');\n\n  const calculateSizes = () => {\n    if (visibleChildren.length === 1) {\n      return ['100%'];\n    }\n\n    if (defaultSizes) {\n      let sizes = defaultSizes.map(s => `calc(${s}% - 2px)`);\n      if (defaultSizes.length === visibleChildren.length) {\n        return sizes;\n      }\n\n      const spaceUsed = visibleChildren.reduce((acc, item) => {\n        const index = children.indexOf(item);\n        return acc + defaultSizes[index];\n      }, 0);\n\n      if (spaceUsed < 100) {\n        const lastIndex = children.indexOf(visibleChildren[visibleChildren.length - 1]);\n        sizes[lastIndex] = `calc(${defaultSizes[lastIndex] + (100 - spaceUsed)}% - 2px)`\n      }\n\n      return sizes;\n    }\n\n    const size = Math.floor(100 / visibleChildren.length);\n    return Array(children.length).fill(`calc(${size}% - 2px)`);\n  };\n\n  const sizes = calculateSizes();\n\n  const panes = children.reduce((acc, item, index) => {\n    // console.log(item);\n    if (!item) {\n      return acc;\n    }\n\n    const visibleIndex = visibleChildren.indexOf(item);\n\n    if (visibleIndex > 0 && visibleIndex < (visibleChildren.length)) {\n      acc.push(<Gutter direction={direction}/>);\n    }\n\n    acc.push(React.cloneElement(item, {key: index, style: { flexBasis: sizes[index], flexGrow: 1}}));\n\n    return acc;\n  }, []);\n\n  return (\n    <Wrapper direction={direction} style={style}>\n      {panes.map((item, key) => React.cloneElement(item, {key}))}\n    </Wrapper>\n  );\n};\n\nSplitPane.propTypes = {\n  direction: PropTypes.string,\n  defaultSizes: PropTypes.array\n};\n","import React from 'react';\nimport styled from 'styled-components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\n\nconst Wrapper = styled.div`\n  position: absolute;\n  display: 'flex';\n  flex-direction: column;\n  width: auto;\n  min-width: 230px;\n  z-index: 9999;\n  background-color: #fff;\n  font-size: 1rem;\n  padding: 10px 0px;\n  border: 1px solid #eee;\n  border-radius: 5px;\n`;\n\nconst ItemWrapper = styled.div`\n  padding: 6px 15px;\n  display: flex;\n  flex-direction: row;\n\n  &:hover {\n    background-color: #eee;\n  }\n\n  > svg {\n    flex-basis: 30px;\n    margin-right: 5px;\n  }\n`;\n\nexport default function DropDownMenu(props) {\n  const {\n    children,\n    onClick,\n    style\n  } = props;\n\n  return (\n    <Wrapper onClick={onClick} style={style}>\n      {React.Children.toArray(children)}\n    </Wrapper>\n  );\n};\n\nexport function DropDownItem(props) {\n  const {\n    label,\n    icon,\n    onClick,\n    text\n  } = props;\n\n  return (\n    <ItemWrapper\n      aria-label={label}\n      onClick={onClick}\n    >\n      <FontAwesomeIcon icon={icon}/> {text}\n    </ItemWrapper>\n  );\n}\n","export default function setupClydeMode(ace) {\n\n  ace.define('ace/mode/clyde_highlight_rules', ['require', 'exports', 'ace/lib/oop', 'ace/mode/text_highlight_rules'], (acequire, exports) => {\n    const oop = acequire('ace/lib/oop');\n    const TextHighlightRules = acequire('ace/mode/text_highlight_rules').TextHighlightRules;\n\n\n    oop.inherits(ClydeHighlightRules, TextHighlightRules);\n\n    exports.ClydeHighlightRules = ClydeHighlightRules;\n  });\n\n  ace.define('ace/mode/clyde', ['require', 'exports', 'ace/lib/oop', 'ace/mode/text', 'ace/mode/clyde_highlight_rules'], (acequire, exports) => {\n    const oop = acequire('ace/lib/oop');\n    const TextMode = acequire('ace/mode/text').Mode;\n    const HighlightRules = acequire('ace/mode/clyde_highlight_rules').ClydeHighlightRules;\n\n    const ClydeMode = function ClydeMode() {\n      this.$id = \"ace/mode/clyde\"\n      this.HighlightRules = HighlightRules;\n      this.lineCommentStart = '--';\n\n      this.getNextLineIndent = function(state, line, tab) {\n        let indent = this.$getIndent(line);\n\n        const { tokens } = this.getTokenizer().getLineTokens(line, state);\n\n        if (tokens.length && tokens[tokens.length-1].type === 'comment') {\n          return indent;\n        }\n\n        if (state === \"start\") {\n          const match = line.match(/^\\s*(\\(|\\*|\\+)/);\n          if (match) {\n            indent += tab;\n          }\n        }\n\n        return indent;\n      };\n    };\n\n    oop.inherits(ClydeMode, TextMode); // ACE's way of doing inheritance\n\n    exports.Mode = ClydeMode;\n  });\n};\n\n\n\nfunction ClydeHighlightRules() {\n  // regexp must not have capturing parentheses. Use (?:) instead.\n  // regexps are ordered -> the first match is used\n  const literals = [\n    { // boolean\n      token : 'constant.language.boolean',\n      regex : /(true|false)/,\n    },\n    { // numbers\n      token : 'constant.numeric',\n      regex : /[0-9,.]+/,\n    },\n    { // string\n      token : 'constant.string',\n      regex : /(\".*\")/,\n    },\n  ];\n\n  const logicalOperators = [\n    { // operators\n      token : 'keyword.operator',\n      regex : /(isnt|ISNT)/,\n    },\n    { // operators\n      token : 'keyword.operator',\n      regex : /(and|or|not|is|AND|OR|NOT|IS)/,\n    },\n    { // operators\n      token : 'keyword.operator',\n      regex : /(&&|\\|\\||<=|>=|==|!=)/,\n    },\n    { // operators\n      token : 'keyword.operator',\n      regex : /(\\*|\\+|-|\\^|\\/|%|<|>|!)/,\n    },\n  ]\n\n  const assignmentOperators = [\n    { // operators\n      token : 'keyword.operator',\n      regex : /(\\+=|-=|\\*=|\\/=|%=|\\^=)/,\n    },\n    { // operators\n      token : 'keyword.operator',\n      regex : /(=)/,\n    },\n  ];\n\n  const logicBlockEnd = [\n    { // assignment block end\n      token : 'keyword',\n      regex : /(\\})/,\n      next: 'start'\n    },\n  ];\n\n  const logicBlockConstants = [\n    {\n      token : 'support.constant',\n      regex : /OPTIONS_COUNT/\n    },\n  ];\n\n  const identifiers = [\n    {\n      token : 'identifier',\n      regex : /[a-zA-Z_][a-zA-Z0-9_]+/\n    },\n  ];\n\n\n  this.$rules = {\n    \"start\" : [\n      {\n        token : 'comment',\n        regex : /^\\s*--.*$/\n      },\n\n      { // Block definition\n        token : [\"keyword\", \"text\", \"variable\"],\n        regex : /^(==)(\\s*)([a-zA-Z0-9_ ]+)$/\n      },\n\n      { // Divert to end\n        token : [\"text\", \"keyword\", \"text\", \"support.constant\"],\n        regex : /(\\s*)(->)(\\s*)(END)$/\n      },\n\n      { // Divert\n        token : [\"text\", \"keyword\", \"text\", \"variable\"],\n        regex : /(\\s*)(->)(\\s*)([a-zA-Z0-9_ ]+)/\n      },\n\n      { // Divert to parent\n        token : [\"text\", \"keyword\", \"text\"],\n        regex : /(\\s*)(<-)(\\s*)/\n      },\n\n      { // Variations start\n        token : [\"text\", \"keyword\", \"text\", \"support.constant\"],\n        regex : /^(\\s*)(\\()(\\s*)((?:shuffle|once|sequence|shuffle once|shuffle sequence)*)$/\n      },\n\n      { // Variations end\n        token : [\"text\", \"keyword\"],\n        regex : /^(\\s*)(\\))$/\n      },\n\n      { // option\n        token : \"keyword.control\",\n        regex : /^(\\s*[*+>])/\n      },\n\n      { // Logic block start\n        token : \"keyword\",\n        regex : /(\\{)/,\n        next: 'logicBlock'\n      },\n\n      { // tag block\n        token : 'constant.string',\n        regex : /#[a-zA-Z0-9_]+/\n      },\n\n      { // Line\n        token : ['variable', 'text', 'variable'],\n        regex: /((?:\\s*[a-zA-Z0-9_] +:)?\\s*)(\".*\")((?:\\$[a-zA-Z0-9_]+)?)/,\n      },\n      { // Line\n        token : ['variable', 'text', 'variable'],\n        regex: /((?:\\s*[a-zA-Z0-9_ ]+:)?\\s*)([^\\r\\n#${]+)((?:\\$[a-zA-Z0-9_]+)?)/,\n      }\n    ],\n    logicBlock: [\n      { // assignment block start\n        token : 'keyword.control',\n        regex : /(set)/,\n        next: 'assignmentBlock'\n      },\n      { // event block start\n        token : 'keyword.control',\n        regex : /(trigger)/,\n        next: 'eventBlock'\n      },\n      { // event block start\n        token : 'keyword.control',\n        regex : /(when)/,\n      },\n      ...logicBlockConstants,\n      ...logicalOperators,\n      ...literals,\n      ...identifiers,\n      ...logicBlockEnd\n    ],\n    assignmentBlock: [\n      ...logicBlockConstants,\n      ...logicalOperators,\n      ...assignmentOperators,\n      ...literals,\n      ...identifiers,\n      ...logicBlockEnd\n    ],\n    eventBlock: [\n      ...identifiers,\n      ...logicBlockEnd\n    ],\n  };\n\n  this.normalizeRules();\n}\n","import React from \"react\";\nimport AceEditor from \"react-ace\";\nimport useResizeObserver from \"use-resize-observer\";\nimport styled from 'styled-components';\n\nimport \"ace-builds/src-noconflict/theme-dracula\";\nimport \"ace-builds/src-noconflict/theme-monokai\";\nimport \"ace-builds/src-noconflict/theme-tomorrow\";\nimport \"ace-builds/src-noconflict/theme-tomorrow_night_eighties\";\nimport \"ace-builds/src-noconflict/theme-textmate\";\n\nimport \"ace-builds/src-noconflict/keybinding-vim\";\n\nimport ClydeMode from './clyde-ace-mode';\n\nconst EditorWrapper = styled.div`\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n`;\n\nconst defaultConfig = {\n  theme: 'dracula',\n  fontSize: 16,\n  tabSize: 4,\n  highlightActiveLine: false,\n  lineWrap: false,\n  useSoftTabs: true,\n  showInvisibles: false,\n  scrollPastEnd: false\n};\n\nexport default function Editor({ defaultValue, setDocumentContent, notifyChange, preferences = defaultConfig, ...props}) {\n  const { ref, width = 500, height = 500 } = useResizeObserver();\n\n  const onBeforeLoad = (editor) => {\n    ClydeMode(editor);\n  };\n\n  const onChange = (value) => {\n    setDocumentContent(value);\n    if (value !== defaultValue) {\n      notifyChange({ text: '<DIALOGUE_CHANGED>'});\n    }\n  };\n\n  return (\n    <EditorWrapper ref={ref} {...props} aria-label=\"Text editor\">\n      <AceEditor\n        defaultValue={defaultValue}\n        mode=\"clyde\"\n        theme={preferences.theme}\n        onBeforeLoad={onBeforeLoad}\n        onChange={onChange}\n        name=\"mainEditor\"\n        width={`${width}px`}\n        height={`${height}px`}\n        editorProps={{ $blockScrolling: true }}\n        fontSize={preferences.fontSize}\n        tabSize={preferences.tabSize}\n        debounceChangePeriod={1000}\n        keyboardHandler={preferences.vimMode ? 'vim' : undefined}\n        highlightActiveLine={preferences.highlightActiveLine}\n        setOptions={{\n          showPrintMargin: false,\n          wrapBehavioursEnabled: preferences.lineWrap,\n          wrap: preferences.lineWrap,\n          useSoftTabs: preferences.useSoftTabs,\n          showInvisibles: preferences.showInvisibles,\n          scrollPastEnd: preferences.scrollPastEnd,\n          navigateWithinSoftTabs: true,\n        }}\n      />\n    </EditorWrapper>\n  );\n}\n","export const LogicInterpreter = (mem) => {\n  const SPECIAL_VARIABLE_NAMES = [ 'OPTIONS_COUNT' ];\n\n  const expressionHandlers = {\n    'equal': cond => getNodeValue(cond.elements[0]) === getNodeValue(cond.elements[1]),\n    'not_equal': cond => getNodeValue(cond.elements[0]) !== getNodeValue(cond.elements[1]),\n    'greater_than': cond => getNodeValue(cond.elements[0]) > getNodeValue(cond.elements[1]),\n    'greater_or_equal': cond => getNodeValue(cond.elements[0]) >= getNodeValue(cond.elements[1]),\n    'less_than': cond => getNodeValue(cond.elements[0]) < getNodeValue(cond.elements[1]),\n    'less_or_equal': cond => getNodeValue(cond.elements[0]) <= getNodeValue(cond.elements[1]),\n    'and': cond => checkCondition(cond.elements[0]) && checkCondition(cond.elements[1]),\n    'or': cond => checkCondition(cond.elements[0]) || checkCondition(cond.elements[1]),\n    'not': cond => !checkCondition(cond.elements[0]),\n    'mult': cond => getNodeValue(cond.elements[0]) * getNodeValue(cond.elements[1]),\n    'div': cond => getNodeValue(cond.elements[0]) / getNodeValue(cond.elements[1]),\n    'sub': cond => getNodeValue(cond.elements[0]) - getNodeValue(cond.elements[1]),\n    'add': cond => getNodeValue(cond.elements[0]) + getNodeValue(cond.elements[1]),\n    'pow': cond => getNodeValue(cond.elements[0]) ** getNodeValue(cond.elements[1]),\n    'mod': cond => getNodeValue(cond.elements[0]) % getNodeValue(cond.elements[1]),\n    'error': cond => { throw new Error(`Unknown expression \"${cond.name}\"`) }\n  };\n\n  const conditionHandlers = {\n    'expression': condition => checkExpression(condition),\n    'variable': condition => checkVariable(condition),\n    'error': condition => { throw new Error(`Unknown condition type \"${condition.type}\"`) }\n  };\n\n  const operationHandlers = {\n    'assign': (name, value) => mem.setVariable(name, value),\n    'assign_sum': (name, value) => mem.setVariable(name, mem.getVariable(name) + value),\n    'assign_sub': (name, value) => mem.setVariable(name, mem.getVariable(name) - value),\n    'assign_mult': (name, value) => mem.setVariable(name, mem.getVariable(name) * value),\n    'assign_div': (name, value) => mem.setVariable(name, mem.getVariable(name) / value),\n    'assign_pow': (name, value) => mem.setVariable(name, mem.getVariable(name) ** value),\n    'assign_mod': (name, value) => mem.setVariable(name, mem.getVariable(name) % value),\n    'error': (_n, _v, a) => { throw new Error(`Unknown operation \"${a.operation}\"`) }\n  };\n\n  const nodeValueHandlers = {\n    'literal': node => node.value,\n    'variable': node => mem.getVariable(node.name),\n    'assignment': node => handleAssignement(node),\n    'expression': node => checkExpression(node),\n    'error': node => { throw new Error(`Unknown node \"${node.type}\"`) }\n  };\n\n  const handleAssignement = (assignment) => {\n    const variable = assignment.variable;\n    const source = assignment.value;\n    const value = getNodeValue(source);\n\n    return (operationHandlers[assignment.operation] || operationHandlers['error'])(variable.name, value, assignment);\n  };\n\n  const getNodeValue = (source) =>\n    (nodeValueHandlers[source.type] || nodeValueHandlers['error'])(source);\n\n  const checkCondition = (condition) =>\n    (conditionHandlers[condition.type] || conditionHandlers['error'])(condition);\n\n  const checkExpression = (condition) =>\n    (expressionHandlers[condition.name] || expressionHandlers['error'])(condition);\n\n  const checkVariable = (variable) => mem.getVariable(variable.name);\n\n  return {\n    checkCondition,\n    handleAssignement,\n    SPECIAL_VARIABLE_NAMES\n  };\n};\n\n","const SPECIAL_VARIABLE_NAMES = [ 'OPTIONS_COUNT' ];\n\nexport function Memory(listeners, init) {\n  let mem = init || {\n    access: {},\n    variables: {},\n    internal: {}\n  };\n\n  return {\n    setAsAccessed(id) {\n      mem.access[id] = true;\n    },\n\n    wasAlreadyAccessed(id) {\n      return !!mem.access[id];\n    },\n\n    getVariable(id, defaultValue) {\n      if (SPECIAL_VARIABLE_NAMES.includes(id)) {\n        return this.getInternalVariable(id, defaultValue);\n      }\n\n      const value = mem.variables[id];\n      if (value === undefined) {\n        return defaultValue;\n      }\n      return value;\n    },\n\n    setVariable(id, value) {\n      listeners.triggerEvent(listeners.events.VARIABLE_CHANGED, { name: id, value, previousValue: mem.variables[id] });\n      return mem.variables[id] = value;\n    },\n\n    setInternalVariable(id, value) {\n      return mem.internal[id] = value;\n    },\n\n    getInternalVariable(id, defaultValue) {\n      const value = mem.internal[id];\n      if (value === undefined) {\n        return defaultValue;\n      }\n      return value;\n    },\n\n    getAll() {\n      return mem;\n    },\n\n    load(data) {\n      mem = data;\n    },\n\n    clear() {\n      mem = {\n        access: {},\n        variables: {},\n        internal: {}\n      };\n    },\n  };\n};\n\n","export const events = {\n  VARIABLE_CHANGED: 'variable_changed',\n  EVENT_TRIGGERED: 'event_triggered'\n};\n\nexport function Events() {\n  const listeners = {\n    [events.VARIABLE_CHANGED]: [],\n    [events.EVENT_TRIGGERED]: [],\n  };\n\n  return {\n    events,\n    triggerEvent(name, data) {\n      listeners[name].forEach(l => l(data));\n    },\n    addListener(name, callback) {\n      listeners[name].push(callback);\n      return callback;\n    },\n    removeListener(name, callback) {\n      const index = listeners[name].indexOf(callback);\n      if (index === -1) {\n        throw new Error('Listener not defined');\n      }\n      listeners[name].splice(index, 1);\n    }\n  }\n}\n","export const TOKENS = {\n  TEXT: 'TEXT',\n  INDENT: 'INDENT',\n  DEDENT: 'DEDENT',\n  OPTION: 'OPTION',\n  STICKY_OPTION: 'STICKY_OPTION',\n  FALLBACK_OPTION: 'FALLBACK_OPTION',\n  BRACKET_OPEN: 'BRACKET_OPEN',\n  BRACKET_CLOSE: 'BRACKET_CLOSE',\n  EOF: 'EOF',\n  SPEAKER: 'SPEAKER',\n  LINE_ID: 'LINE_ID',\n  TAG: 'TAG',\n  BLOCK: 'BLOCK',\n  DIVERT: 'DIVERT',\n  DIVERT_PARENT: 'DIVERT_PARENT',\n  VARIATIONS_MODE: 'VARIATIONS_MODE',\n  MINUS: '-',\n  PLUS: '+',\n  MULT: '*',\n  DIV: '/',\n  POWER: '^',\n  MOD: '%',\n  BRACE_OPEN: '{',\n  BRACE_CLOSE: '}',\n  AND: 'AND',\n  OR: 'OR',\n  NOT:'NOT',\n  EQUAL: '==, is',\n  NOT_EQUAL: '!=, isnt',\n  GE: '>=',\n  LE: '<=',\n  GREATER: 'GREATER',\n  LESS: 'LESS',\n  NUMBER_LITERAL: 'number',\n  NULL_TOKEN: 'null',\n  BOOLEAN_LITERAL: 'boolean',\n  STRING_LITERAL: 'string',\n  IDENTIFIER: 'identifier',\n  KEYWORD_SET: 'set',\n  KEYWORD_TRIGGER: 'trigger',\n  KEYWORD_WHEN: 'when',\n  ASSIGN: '=',\n  ASSIGN_SUM: '+=',\n  ASSIGN_SUB: '-=',\n  ASSIGN_DIV: '/=',\n  ASSIGN_MULT: '*=',\n  ASSIGN_POW: '^=',\n  ASSIGN_MOD: '%=',\n  COMMA: ',',\n  LINE_BREAK: 'line break',\n}\n\nconst MODES = {\n  DEFAULT: 'DEFAULT',\n  OPTION: 'OPTION',\n  QSTRING: 'QSTRING',\n  LOGIC: 'LOGIC',\n  VARIATIONS: 'VARIATIONS',\n};\n\nconst tokenFriendlyHint = {\n  [TOKENS.TEXT]: 'text',\n  [TOKENS.INDENT]: 'INDENT',\n  [TOKENS.DEDENT]: 'DEDENT',\n  [TOKENS.OPTION]: '*',\n  [TOKENS.STICKY_OPTION]: '+',\n  [TOKENS.FALLBACK_OPTION]: '>',\n  [TOKENS.BRACKET_OPEN]: '(',\n  [TOKENS.BRACKET_CLOSE]: ')',\n  [TOKENS.EOF]: 'EOF',\n  [TOKENS.SPEAKER]: '<speaker name>:',\n  [TOKENS.LINE_ID]: '$id',\n  [TOKENS.TAG]: '#tag',\n  [TOKENS.BLOCK]: '== <block name>',\n  [TOKENS.DIVERT]: '-> <target name>',\n  [TOKENS.DIVERT_PARENT]: '<-',\n  [TOKENS.VARIATIONS_MODE]: '<variations mode>',\n  [TOKENS.BRACE_OPEN]: '{',\n  [TOKENS.BRACE_CLOSE]: '}',\n  [TOKENS.AND]: '&&, and',\n  [TOKENS.OR]: '||, or',\n  [TOKENS.NOT]:' not, !',\n  [TOKENS.EQUAL]: '==, is',\n  [TOKENS.NOT_EQUAL]: '!=, isnt',\n  [TOKENS.GE]: '>=',\n  [TOKENS.LE]: '<=',\n  [TOKENS.GREATER]: '>',\n  [TOKENS.LESS]: '<',\n}\n\nexport function getTokenFriendlyHint(token) {\n  const hint = tokenFriendlyHint[token];\n  if (!hint) {\n    return token;\n  }\n  return hint;\n}\n\nexport function tokenize(input) {\n  let indent = [0];\n  let position = 0;\n  let line = 0;\n  let column = 0;\n  let length = input.length;\n  let pendingTokens = [];\n  const modes = [\n    MODES.DEFAULT\n  ];\n  let currentQuote = null;\n\n  const stackMode = (mode) => {\n    modes.unshift(mode);\n  };\n\n  const popMode = () => {\n    if (modes.length > 1) {\n      modes.shift();\n    }\n  };\n\n  const isCurrentMode = (mode) => {\n    return modes[0] === mode;\n  };\n\n  const checkSequence = (string, initialPosition, value) => {\n    const sequence = string.slice(initialPosition, initialPosition + value.length);\n    return sequence === value;\n  };\n\n\n  // handle indentation\n  const handleIndent = () => {\n    let initialLine = line;\n\n    let indentation = 0;\n    while (input[position] && input[position].match(/[\\t ]/)) {\n      indentation += 1;\n      position += 1;\n    }\n    if (indentation > indent[0]) {\n        const previousIndent = indent[0];\n        column += indentation;\n        indent.unshift(indentation);\n        return Token(TOKENS.INDENT, initialLine, previousIndent);\n    }\n\n    if (indentation === indent[0]) {\n      column = indent[0]\n      return;\n    }\n\n    let tokens = [];\n    while (indentation < indent[0]) {\n        indent.shift();\n        column = indent[0];\n        tokens.push(Token(TOKENS.DEDENT, line, column));\n    }\n\n    return tokens;\n  };\n\n  // handle comments\n  const handleComments = () => {\n    while (input[position] && input[position] !== '\\n') {\n      position += 1;\n    }\n    position += 1;\n    line += 1;\n  };\n\n  // handle line breaks\n  const handleLineBreaks = () => {\n    while (input[position] === '\\n') {\n      line += 1;\n      position += 1;\n      column = 0;\n    }\n\n    if (isCurrentMode(MODES.OPTION)) {\n      popMode();\n    }\n  };\n\n  // handle spaces\n  const handleSpace = () => {\n    while (input[position] === ' ') {\n      position += 1;\n      column += 1;\n    }\n  };\n\n  // handle text\n  const handleText = () => {\n    const initialLine = line;\n    const initialColumn = column;\n    let value = [];\n\n    while (position < input.length) {\n      const currentChar = input[position];\n\n      if (['\\n', '$', '#', '{' ].includes(currentChar)) {\n        break;\n      }\n\n      if (currentChar === '\\\\' && input[position + 1] !== 'n') {\n        value.push(input[position + 1]);\n        position += 2;\n        column += 2;\n        continue;\n      }\n\n      if (currentChar === ':') {\n        position += 1;\n        column += 1;\n        return Token(TOKENS.SPEAKER, initialLine, initialColumn, value.join('').trim());\n      }\n\n      value.push(currentChar);\n\n      position += 1;\n      column += 1;\n    }\n\n\n    return Token(TOKENS.TEXT, initialLine, initialColumn, value.join('').trim());\n  };\n\n  // handle text in quotes\n  const handleQText = () => {\n    const initialLine = line;\n    const initialColumn = column;\n    let value = [];\n\n    while (position < input.length) {\n      const currentChar = input[position];\n\n\n      if (currentChar === currentQuote) {\n        break;\n      }\n\n      if (currentChar === '\\\\' && input[position + 1] === currentQuote) {\n        value.push(input[position + 1]);\n        position += 2;\n        column += 2;\n        continue;\n      }\n\n      value.push(currentChar);\n\n      position += 1;\n      column += 1;\n    }\n\n\n    return Token(TOKENS.TEXT, initialLine, initialColumn, value.join('').trim());\n  };\n\n  // handle quote\n  const handleQuote = () => {\n    column += 1;\n    position += 1;\n    if (isCurrentMode(MODES.QSTRING)) {\n      currentQuote = null;\n      popMode();\n    } else {\n      stackMode(MODES.QSTRING);\n    }\n  };\n\n  const optionTypes = {\n    '*': TOKENS.OPTION,\n    '+': TOKENS.STICKY_OPTION,\n    '>': TOKENS.FALLBACK_OPTION,\n  };\n\n  // handle options\n  const handleOption = () => {\n    const token = optionTypes[input[position]];\n\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    stackMode(MODES.OPTION);\n    return Token(token, line, initialColumn);\n  };\n\n  const handleOptionDisplayChar = () => {\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    return Token(TOKENS.ASSIGN, line, initialColumn);\n  };\n\n  const handleLineId = () => {\n    const initialColumn = column;\n    let values = [];\n    position += 1;\n    column += 1;\n\n    while (input[position] && input[position].match(/[A-Z|a-z|0-9|_]/)) {\n      values.push(input[position]);\n      position += 1;\n      column += 1;\n    }\n    return Token(TOKENS.LINE_ID, line, initialColumn, values.join(''));\n  };\n\n  const handleTag = () => {\n    const initialColumn = column;\n    let values = [];\n    position += 1;\n    column += 1;\n\n    while (input[position] && input[position].match(/[A-Z|a-z|0-9|_]/)) {\n      values.push(input[position]);\n      position += 1;\n      column += 1;\n    }\n    return Token(TOKENS.TAG, line, initialColumn, values.join(''));\n  };\n\n  const handleBlock = () => {\n    const initialColumn = column;\n    let values = [];\n    position += 2;\n    column += 2;\n\n    while (input[position] && input[position].match(/[A-Z|a-z|0-9|_| ]/)) {\n      values.push(input[position]);\n      position += 1;\n      column += 1;\n    }\n    return Token(TOKENS.BLOCK, line, initialColumn, values.join('').trim());\n  };\n\n  const handleDivert = () => {\n    const initialColumn = column;\n    let values = [];\n    position += 2;\n    column += 2;\n\n    while (input[position] && input[position].match(/[A-Z|a-z|0-9|_| ]/)) {\n      values.push(input[position]);\n      position += 1;\n      column += 1;\n    }\n\n    const token = Token(TOKENS.DIVERT, line, initialColumn, values.join('').trim());\n    const linebreak = getFollowingLineBreak();\n    if (linebreak) {\n      return [ token, linebreak ];\n    }\n\n    return token;\n  };\n\n  const handleDivertToParent = () => {\n    const initialColumn = column;\n    position += 2;\n    column += 2;\n\n    const token = Token(TOKENS.DIVERT_PARENT, line, initialColumn);\n    const linebreak = getFollowingLineBreak();\n\n    if (linebreak) {\n      return [ token, linebreak ];\n    }\n\n    return token;\n  };\n\n  const handleStartVariations = () => {\n    const initialColumn = column;\n    const values = [];\n    column += 1;\n    position += 1;\n    stackMode(MODES.VARIATIONS);\n\n    while (input[position] && input[position].match(/[A-Z|a-z| ]/)) {\n      values.push(input[position]);\n      position += 1;\n      column += 1;\n    }\n\n    const tokens = [\n      Token(TOKENS.BRACKET_OPEN, line, initialColumn)\n    ];\n\n    const value = values.join('').trim();\n\n    if (value.length) {\n      tokens.push(Token(TOKENS.VARIATIONS_MODE, line, initialColumn + 2, value));\n    }\n\n    return tokens;\n  };\n\n  const handleStopVariations = () => {\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    popMode();\n    return Token(TOKENS.BRACKET_CLOSE, line, initialColumn);\n  };\n\n  const handleVariationItem = () => {\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    return Token(TOKENS.MINUS, line, initialColumn);\n  };\n\n\n  const handleLogicBlockStart = () => {\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    stackMode(MODES.LOGIC);\n    const token = Token(TOKENS.BRACE_OPEN, line, initialColumn);\n    const linebreak = getLeadingLineBreak();\n    if (linebreak) {\n      return [ linebreak, token ];\n    }\n    return token;\n  };\n\n  const handleLogicBlockStop = () => {\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    popMode();\n    const token = Token(TOKENS.BRACE_CLOSE, line, initialColumn);\n    const linebreak = getFollowingLineBreak();\n    if (linebreak) {\n      return [ token, linebreak ];\n    }\n    return token;\n  };\n\n  const keywords = [\n    'is', 'isnt', 'or', 'and', 'not', 'true', 'false', 'null',\n    'set', 'trigger', 'when'\n  ];\n\n  const handleLogicIdentifier = () => {\n    const initialColumn = column;\n    let values = '';\n\n    while (input[position] && input[position].match(/[A-Z|a-z|0-9|_]/)) {\n      values += input[position];\n      position += 1;\n      column += 1;\n    }\n\n    if (keywords.includes(values.toLowerCase())) {\n      return handleLogicDescriptiveOperator(values, initialColumn);\n    }\n\n    return Token(TOKENS.IDENTIFIER, line, initialColumn, values.trim());\n  };\n\n  const handleLogicDescriptiveOperator = (value, initialColumn) => {\n    switch(value.toLowerCase()) {\n      case 'not':\n        return Token(TOKENS.NOT, line, initialColumn);\n      case 'and':\n        return Token(TOKENS.AND, line, initialColumn);\n      case 'or':\n        return Token(TOKENS.OR, line, initialColumn);\n      case 'is':\n        return Token(TOKENS.EQUAL, line, initialColumn);\n      case 'isnt':\n        return Token(TOKENS.NOT_EQUAL, line, initialColumn);\n      case 'true':\n      case 'false':\n        return Token(TOKENS.BOOLEAN_LITERAL, line, initialColumn, value);\n      case 'null':\n        return Token(TOKENS.NULL_TOKEN, line, initialColumn);\n      case 'set':\n        return Token(TOKENS.KEYWORD_SET, line, initialColumn);\n      case 'trigger':\n        return Token(TOKENS.KEYWORD_TRIGGER, line, initialColumn);\n      case 'when':\n        return Token(TOKENS.KEYWORD_WHEN, line, initialColumn);\n    }\n\n  };\n\n  const handleLogicNot = () => {\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    return Token(TOKENS.NOT, line, initialColumn);\n  };\n\n  const handleLogicOperator = (token, length) => {\n    const initialColumn = column;\n    column += length;\n    position += length;\n    return Token(token, line, initialColumn);\n  };\n\n  const handleLogicNumber = () => {\n    const initialColumn = column;\n    let values = '';\n\n    while (input[position] && input[position].match(/[0-9|.]/)) {\n      values += input[position];\n      position += 1;\n      column += 1;\n    }\n\n    return Token(TOKENS.NUMBER_LITERAL, line, initialColumn, values);\n  };\n\n  const handleLogicString = () => {\n    const initialColumn = column;\n    column += 1;\n    position += 1;\n    const token = handleQText();\n    column += 1;\n    position += 1;\n\n    token.token = TOKENS.STRING_LITERAL;\n    token.column = initialColumn;\n\n    return token;\n  };\n\n  const createSimpleToken = (token, length = 1) => {\n    const initialColumn = column;\n    column += length;\n    position += length;\n    return Token(token, line, initialColumn);\n  };\n\n  const handleLogicBlock = () => {\n    if (input[position] === '\"' || input[position] == \"'\") {\n      if (currentQuote === null) {\n        currentQuote = input[position]\n      }\n      return handleLogicString();\n    }\n\n    if (input[position] === '}') {\n      return handleLogicBlockStop();\n    }\n\n    if (checkSequence(input, position, '==')) {\n      return handleLogicOperator(TOKENS.EQUAL, 2);\n    }\n\n    if (checkSequence(input, position, '!=')) {\n      return handleLogicOperator(TOKENS.NOT_EQUAL, 2);\n    }\n\n    if (checkSequence(input, position, '&&')) {\n      return handleLogicOperator(TOKENS.AND, 2);\n    }\n\n    if (checkSequence(input, position, '||')) {\n      return handleLogicOperator(TOKENS.OR, 2);\n    }\n\n    if (checkSequence(input, position, '<=')) {\n      return handleLogicOperator(TOKENS.LE, 2);\n    }\n\n    if (checkSequence(input, position, '>=')) {\n      return handleLogicOperator(TOKENS.GE, 2);\n    }\n\n    if (checkSequence(input, position, '<')) {\n      return handleLogicOperator(TOKENS.LESS, 1);\n    }\n\n    if (checkSequence(input, position, '>')) {\n      return handleLogicOperator(TOKENS.GREATER, 1);\n    }\n\n    if (input[position] === '=') {\n      return createSimpleToken(TOKENS.ASSIGN);\n    }\n\n    if (checkSequence(input, position, '-=')) {\n      return createSimpleToken(TOKENS.ASSIGN_SUB, 2);\n    }\n\n    if (checkSequence(input, position, '+=')) {\n      return createSimpleToken(TOKENS.ASSIGN_SUM, 2);\n    }\n\n    if (checkSequence(input, position, '*=')) {\n      return createSimpleToken(TOKENS.ASSIGN_MULT, 2);\n    }\n\n    if (checkSequence(input, position, '/=')) {\n      return createSimpleToken(TOKENS.ASSIGN_DIV, 2);\n    }\n\n    if (checkSequence(input, position, '^=')) {\n      return createSimpleToken(TOKENS.ASSIGN_POW, 2);\n    }\n\n    if (checkSequence(input, position, '%=')) {\n      return createSimpleToken(TOKENS.ASSIGN_MOD, 2);\n    }\n\n    if (input[position] === '+') {\n      return createSimpleToken(TOKENS.PLUS, 1);\n    }\n\n    if (input[position] === '-') {\n      return createSimpleToken(TOKENS.MINUS, 1);\n    }\n\n    if (input[position] === '*') {\n      return createSimpleToken(TOKENS.MULT, 1);\n    }\n\n    if (input[position] === '/') {\n      return createSimpleToken(TOKENS.DIV, 1);\n    }\n\n    if (input[position] === '^') {\n      return createSimpleToken(TOKENS.POWER, 1);\n    }\n\n    if (input[position] === '%') {\n      return createSimpleToken(TOKENS.MOD, 1);\n    }\n\n    if (input[position] === ',') {\n      return createSimpleToken(TOKENS.COMMA, 1);\n    }\n\n    if (input[position] === '!') {\n      return handleLogicNot();\n    }\n\n    if (input[position].match(/[0-9]/)) {\n      return handleLogicNumber();\n    }\n\n    if (input[position].match(/[A-Za-z]/)) {\n      return handleLogicIdentifier();\n    }\n  };\n\n  const getFollowingLineBreak = () => {\n    let lookupPosition = position;\n    let lookupColumn = column;\n    while (input[lookupPosition] === ' ') {\n      lookupPosition += 1;\n      lookupColumn += 1;\n    }\n\n    if (input[lookupPosition] === '\\n') {\n      return Token(TOKENS.LINE_BREAK, line, lookupColumn);\n    }\n  };\n\n  const getLeadingLineBreak = () => {\n    let lookupPosition = position - 2;\n    while (input[lookupPosition] === ' ') {\n      lookupPosition -= 1;\n    }\n\n    if (input[lookupPosition] === '\\n') {\n      return Token(TOKENS.LINE_BREAK, line, 0);\n    }\n  };\n\n  // get next token\n  function getNextToken() {\n    if (!isCurrentMode(MODES.QSTRING) && input[position] === '-' && input[position + 1] === '-') {\n      return handleComments();\n    }\n\n    if (!isCurrentMode(MODES.QSTRING) && input[position] === '\\n') {\n      return handleLineBreaks();\n    }\n\n    if (!isCurrentMode(MODES.LOGIC) && ((column === 0 && input[position].match(/[\\t ]/)) || (column === 0 && indent.length > 1))) {\n      return handleIndent();\n    }\n\n    if (!isCurrentMode(MODES.QSTRING) && input[position] === '{') {\n      return handleLogicBlockStart();\n    }\n\n    if(isCurrentMode(MODES.LOGIC)) {\n      const response = handleLogicBlock();\n\n      if (response)  {\n        return response;\n      }\n    }\n\n    if (input[position] === '\"' || input[position] === \"'\") {\n      if (currentQuote === null) {\n        currentQuote = input[position]\n      }\n\n      if (input[position] === currentQuote) {\n        return handleQuote();\n      }\n    }\n\n    if (isCurrentMode(MODES.QSTRING)) {\n      return handleQText();\n    }\n\n    if (input[position] === ' ') {\n      return handleSpace();\n    }\n\n    if (input[position] === '(') {\n      return handleStartVariations();\n    }\n\n    if (input[position] === ')') {\n      return handleStopVariations();\n    }\n\n    if (column === 0 && input[position] === '=' && input[position + 1] === '=') {\n      return handleBlock();\n    }\n\n    if (input[position] === '-' && input[position + 1] === '>') {\n      return handleDivert();\n    }\n\n    if (input[position] === '<' && input[position + 1] === '-') {\n      return handleDivertToParent();\n    }\n\n    if (isCurrentMode(MODES.VARIATIONS) && input[position] === '-') {\n      return handleVariationItem();\n    }\n\n    if (input[position] === '*' || input[position] === '+'|| input[position] === '>') {\n      return handleOption();\n    }\n\n    if (isCurrentMode(MODES.OPTION) && input[position] === '=') {\n      return handleOptionDisplayChar();\n    }\n\n    if (input[position] === '$') {\n      return handleLineId();\n    }\n\n    if (input[position] === '#') {\n      return handleTag();\n    }\n\n    return handleText();\n  }\n\n  return {\n    // returns a list with all tokens\n    getAll() {\n      let tokens = [];\n      while (position < length) {\n        const token = getNextToken(input, position, line, column, indent);\n        if (token) {\n          if (Array.isArray(token)) {\n            tokens = tokens.concat(token);\n          } else {\n            tokens.push(token);\n          }\n        }\n      }\n\n      position += 1;\n      tokens.push(Token(TOKENS.EOF, line, column));\n\n      return tokens;\n    },\n\n    // retuns a token each time\n    next() {\n      if (pendingTokens.length) {\n        return pendingTokens.shift();\n      }\n\n      while (position < length) {\n        const token = getNextToken(input, position, line, column, indent);\n        if (token) {\n          if (Array.isArray(token)) {\n            pendingTokens = token;\n            return pendingTokens.shift();\n          } else {\n            return token;\n          }\n        }\n      }\n\n      if (position === length) {\n        position += 1;\n        return Token(TOKENS.EOF, line, column);\n      }\n    }\n  }\n}\n\nexport function Token(token, line, column, value) {\n  return {\n    token,\n    value,\n    line,\n    column\n  };\n}\n\n\n","export const DocumentNode = (content = [], blocks = []) => {\n  return { type: 'document', content, blocks};\n};\n\nexport const ContentNode = (content) => {\n  return { type: 'content', content };\n};\n\nexport const BlockNode = (blockName, content) => {\n  return { type: 'block', name: blockName, content };\n}\n\nexport const LineNode = (value, speaker, id, tags) => {\n  return { type: 'line', value, speaker, id, tags };\n};\n\nexport const OptionsNode = (content, name, id, speaker, tags) => {\n  return { type: 'options', name, content, id, speaker, tags };\n}\n\nexport const OptionNode = (content, mode, name, id, speaker, tags) => {\n  return { type: 'option', name, mode, content, id, speaker, tags };\n}\n\nexport const DivertNode = (target) => {\n  if (target === 'END') {\n    target = '<end>';\n  }\n  return { type: 'divert', target };\n}\n\nexport const VariationsNode = (mode, content = []) => {\n  return { type: 'variations', mode, content };\n}\n\nexport const VariableNode = (name) => {\n  return { type: 'variable', name };\n}\n\nexport const NumberLiteralNode = (value) => {\n  return LiteralNode('number', Number(value));\n}\n\nexport const BooleanLiteralNode = (value) => {\n  return LiteralNode('boolean', value === 'true');\n}\n\nexport const StringLiteralNode = (value) => {\n  return LiteralNode('string', value);\n}\n\nexport const LiteralNode = (name, value) => {\n  return { type: 'literal', name, value };\n}\n\nexport const NullTokenNode = () => {\n  return { type: 'null' };\n}\n\nexport const ConditionalContentNode = (conditions, content) => {\n  return { type: 'conditional_content', conditions, content };\n}\n\nexport const ActionContentNode = (action, content) => {\n  return { type: 'action_content', action, content };\n}\n\nexport const ExpressionNode = (name, elements) => {\n  return { type: 'expression', name, elements };\n}\n\nexport const AssignmentsNode = (assignments) => {\n  return { type: 'assignments', assignments };\n}\n\nexport const AssignmentNode = (variable, operation, value) => {\n  return { type: 'assignment', variable, operation, value };\n}\n\nexport const EventsNode = (events) => {\n  return { type: 'events', events };\n}\n\nexport const EventNode = (name) => {\n  return { type: 'event', name };\n}\n","import { TOKENS, tokenize, getTokenFriendlyHint } from './lexer.js';\n\nimport {\n  DocumentNode,\n  ContentNode,\n  BlockNode,\n  LineNode,\n  OptionsNode,\n  OptionNode,\n  DivertNode,\n  VariationsNode,\n  VariableNode,\n  NumberLiteralNode,\n  BooleanLiteralNode,\n  StringLiteralNode,\n  NullTokenNode,\n  ConditionalContentNode,\n  ActionContentNode,\n  ExpressionNode,\n  AssignmentsNode,\n  AssignmentNode,\n  EventsNode,\n  EventNode,\n} from './nodes.js';\n\nconst variationsModes = ['sequence', 'once', 'cycle', 'shuffle', 'shuffle sequence', 'shuffle once', 'shuffle cycle' ];\nconst operators = {\n  [TOKENS.AND]: { precedence: 1, associative: 'LEFT' },\n  [TOKENS.OR]: { precedence: 1, associative: 'LEFT' },\n  [TOKENS.EQUAL]: { precedence: 2, associative: 'LEFT' },\n  [TOKENS.NOT_EQUAL]: { precedence: 2, associative: 'LEFT' },\n  [TOKENS.GREATER]: { precedence: 2, associative: 'LEFT' },\n  [TOKENS.LESS]: { precedence: 2, associative: 'LEFT' },\n  [TOKENS.GE]: { precedence: 2, associative: 'LEFT' },\n  [TOKENS.LE]: { precedence: 2, associative: 'LEFT' },\n  [TOKENS.PLUS]: { precedence: 3, associative: 'LEFT' },\n  [TOKENS.MINUS]: { precedence: 3, associative: 'LEFT' },\n  [TOKENS.MOD]: { precedence: 4, associative: 'LEFT' },\n  [TOKENS.MULT]: { precedence: 5, associative: 'LEFT' },\n  [TOKENS.DIV]: { precedence: 5, associative: 'LEFT' },\n  [TOKENS.POWER]: { precedence: 7, associative: 'RIGHT' },\n};\n\nconst assignmentOperators = {\n  [TOKENS.ASSIGN]: 'assign',\n  [TOKENS.ASSIGN_SUM]: 'assign_sum',\n  [TOKENS.ASSIGN_SUB]: 'assign_sub',\n  [TOKENS.ASSIGN_MULT]: 'assign_mult',\n  [TOKENS.ASSIGN_DIV]: 'assign_div',\n  [TOKENS.ASSIGN_POW]: 'assign_pow',\n  [TOKENS.ASSIGN_MOD]: 'assign_mod',\n};\n\n/**\n * Parses Clyde dialogue string to Clyde object\n *\n * @param {string} doc - Clyde document string\n * @return {Object} Clyde JSON representation\n */\nexport default function parse(doc) {\n  const tokens = tokenize(doc);\n  // console.log(tokenize(doc).getAll());\n  // console.log(JSON.stringify(test.getAll()));\n  let currentToken;\n  let lookaheadTokens = [];\n  let isMultilineEnabled = true;\n\n  const wrongTokenError = (token, expected) => {\n    throw new Error(`Unexpected token \"${getTokenFriendlyHint(token.token)}\" on line ${token.line+1} column ${token.column+1}. Expected ${expected.map(getTokenFriendlyHint).join(', ')} `);\n  }\n\n  const consume = (expected) => {\n    if (!lookaheadTokens.length) {\n      lookaheadTokens.push(tokens.next());\n    }\n\n    const lookahead = lookaheadTokens.shift();\n\n    if (expected && (!lookahead || !expected.includes(lookahead.token))) {\n      wrongTokenError(lookahead, expected);\n    }\n\n    currentToken = lookahead;\n    return currentToken;\n  };\n\n  const peek = (expected, offset = 0) => {\n    while (lookaheadTokens.length < (offset + 1)) {\n      const token = tokens.next();\n      if (token) {\n        lookaheadTokens.push(token);\n      } else {\n        break;\n      }\n    }\n    const lookahead = lookaheadTokens[offset];\n\n    if (!expected || (lookahead && expected.includes(lookahead.token))) {\n      return lookahead;\n    }\n  };\n\n  const Document = () => {\n    const expected = [\n      TOKENS.EOF,\n      TOKENS.SPEAKER,\n      TOKENS.TEXT,\n      TOKENS.OPTION,\n      TOKENS.STICKY_OPTION,\n      TOKENS.FALLBACK_OPTION,\n      TOKENS.DIVERT,\n      TOKENS.DIVERT_PARENT,\n      TOKENS.BRACKET_OPEN,\n      TOKENS.BRACE_OPEN,\n    ];\n    const next = peek();\n\n    switch (next.token) {\n      case TOKENS.EOF:\n        return DocumentNode();\n      case TOKENS.SPEAKER:\n      case TOKENS.TEXT:\n      case TOKENS.OPTION:\n      case TOKENS.STICKY_OPTION:\n      case TOKENS.FALLBACK_OPTION:\n      case TOKENS.DIVERT:\n      case TOKENS.DIVERT_PARENT:\n      case TOKENS.BRACKET_OPEN:\n      case TOKENS.BRACE_OPEN:\n      case TOKENS.LINE_BREAK:\n        const result =  DocumentNode([ContentNode(Lines())]);\n        if (peek([TOKENS.BLOCK])) {\n          result.blocks = Blocks();\n        }\n        return result;\n      case TOKENS.BLOCK:\n        return DocumentNode([], Blocks());\n      default:\n        wrongTokenError(next, expected);\n    };\n  };\n\n  const Blocks = () => {\n    consume([TOKENS.BLOCK]);\n    let blocks =  [\n      BlockNode(currentToken.value, ContentNode(Lines()))\n    ];\n\n    while (peek([TOKENS.BLOCK])) {\n      blocks = blocks.concat(Blocks());\n    }\n\n    return blocks;\n  };\n\n  const Lines = () => {\n    const acceptableNext = [\n      TOKENS.SPEAKER,\n      TOKENS.TEXT,\n      TOKENS.OPTION,\n      TOKENS.STICKY_OPTION,\n      TOKENS.FALLBACK_OPTION,\n      TOKENS.DIVERT,\n      TOKENS.DIVERT_PARENT,\n      TOKENS.BRACKET_OPEN,\n      TOKENS.BRACE_OPEN,\n      TOKENS.LINE_BREAK,\n    ];\n    let lines;\n    const tk = peek(acceptableNext);\n\n    if (!tk) {\n      return [];\n    }\n\n    switch (tk.token) {\n      case TOKENS.SPEAKER:\n      case TOKENS.TEXT:\n        consume([ TOKENS.SPEAKER, TOKENS.TEXT ]);\n        const line = Line();\n        if (peek([TOKENS.BRACE_OPEN])) {\n          consume([TOKENS.BRACE_OPEN]);\n          lines = [LineWithAction(line)];\n        } else {\n          lines = [line];\n        }\n        break;\n      case TOKENS.OPTION:\n      case TOKENS.STICKY_OPTION:\n      case TOKENS.FALLBACK_OPTION:\n        lines = [Options()];\n        break;\n      case TOKENS.DIVERT:\n      case TOKENS.DIVERT_PARENT:\n        lines = [Divert()];\n        break;\n      case TOKENS.BRACKET_OPEN:\n        consume([ TOKENS.BRACKET_OPEN ]);\n        lines = [Variations()];\n        break;\n      case TOKENS.LINE_BREAK:\n        consume([ TOKENS.LINE_BREAK ]);\n      case TOKENS.BRACE_OPEN:\n        consume([TOKENS.BRACE_OPEN]);\n        if (peek([TOKENS.KEYWORD_SET, TOKENS.KEYWORD_TRIGGER])) {\n          lines = [LineWithAction()];\n        } else {\n          if (peek([TOKENS.KEYWORD_WHEN])) {\n            consume([TOKENS.KEYWORD_WHEN]);\n          }\n          lines = [ConditionalLine()];\n        }\n        break;\n    }\n\n    if (peek(acceptableNext)) {\n      lines = lines.concat(Lines());\n    }\n\n    return lines;\n  }\n\n  const Line = () => {\n    return DialogueLine();\n  };\n\n  const DialogueLine = () => {\n    switch (currentToken.token) {\n      case TOKENS.SPEAKER:\n        return LineWithSpeaker();\n      case TOKENS.TEXT:\n        return TextLine();\n    }\n  };\n\n  const LineWithSpeaker = () => {\n    const { value } = currentToken;\n    consume([TOKENS.TEXT]);\n    const line = DialogueLine();\n    line.speaker =  value;\n    return line;\n  }\n\n  const TextLine = () => {\n    const { value } = currentToken;\n    const next = peek([TOKENS.LINE_ID, TOKENS.TAG]);\n    let line;\n\n    if (next) {\n      consume([TOKENS.LINE_ID, TOKENS.TAG]);\n      line = LineWithMetadata();\n      line.value = value;\n    } else {\n      line = LineNode(value);\n    }\n\n    if (isMultilineEnabled && peek([TOKENS.INDENT])) {\n      consume([TOKENS.INDENT]);\n\n      if (peek([TOKENS.OPTION, TOKENS.STICKY_OPTION, TOKENS.FALLBACK_OPTION])) {\n        const options = Options();\n        options.id = line.id;\n        options.name = line.value;\n        options.tags = line.tags;\n        line = options;\n      } else {\n        while (!peek([TOKENS.DEDENT, TOKENS.EOF])) {\n          consume([TOKENS.TEXT]);\n          const nextLine = TextLine();\n          line.value += ` ${nextLine.value}`;\n          if (nextLine.id) {\n            line.id = nextLine.id;\n          }\n\n          if (nextLine.tags) {\n            line.tags = nextLine.tags;\n          }\n        }\n        consume([TOKENS.DEDENT, TOKENS.EOF]);\n      }\n    }\n\n    return line;\n  }\n\n  const LineWithMetadata = () => {\n    switch (currentToken.token) {\n      case TOKENS.LINE_ID:\n        return LineWithId();\n      case TOKENS.TAG:\n        return LineWithTags();\n    }\n  };\n\n  const LineWithId = () => {\n    const { value } = currentToken;\n    const next = peek([TOKENS.TAG]);\n    if (next) {\n      consume([TOKENS.TAG]);\n      const line = LineWithTags();\n      line.id = value;\n      return line;\n    }\n    return LineNode(undefined, undefined, value);\n  };\n\n  const LineWithTags = () => {\n    const { value } = currentToken;\n    const next = peek([TOKENS.LINE_ID, TOKENS.TAG]);\n    if (next) {\n      consume([TOKENS.LINE_ID, TOKENS.TAG]);\n      const line = LineWithMetadata();\n      if (!line.tags) {\n        line.tags = [];\n      }\n      line.tags.unshift(value);\n      return line;\n    }\n    return LineNode(undefined, undefined, undefined, [value]);\n  };\n\n  const Options = () => {\n    const options = OptionsNode([]);\n\n    while (peek([TOKENS.OPTION, TOKENS.STICKY_OPTION, TOKENS.FALLBACK_OPTION])) {\n      options.content.push(Option());\n    }\n\n    if (peek([ TOKENS.DEDENT ])) {\n      consume([ TOKENS.DEDENT ]);\n    }\n\n    return options;\n  };\n\n  const optionType = {\n    [TOKENS.OPTION]: 'once',\n    [TOKENS.STICKY_OPTION]: 'sticky',\n    [TOKENS.FALLBACK_OPTION]: 'fallback',\n  }\n\n  const Option = () => {\n    consume([TOKENS.OPTION, TOKENS.STICKY_OPTION, TOKENS.FALLBACK_OPTION])\n    const type = optionType[currentToken.token];\n\n    const acceptableNext = [TOKENS.SPEAKER, TOKENS.TEXT, TOKENS.INDENT, TOKENS.ASSIGN, TOKENS.BRACE_OPEN];\n    let lines = [];\n    let mainItem;\n    let includeLabelAsContent = false;\n    let root;\n    let wrapper;\n\n    consume(acceptableNext);\n\n    if (currentToken.token === TOKENS.ASSIGN) {\n      includeLabelAsContent = true;\n      consume(acceptableNext);\n    }\n\n    if (currentToken.token === TOKENS.BRACE_OPEN) {\n      const block = NestedLogicBlocks();\n      root = block.root;\n      wrapper = block.wrapper;\n      consume(acceptableNext);\n    }\n\n    switch (currentToken.token) {\n      case TOKENS.SPEAKER:\n      case TOKENS.TEXT:\n        isMultilineEnabled = false;\n        mainItem = Line();\n        isMultilineEnabled = true;\n        if (includeLabelAsContent) {\n          lines.push(mainItem);\n        }\n\n    }\n\n    if (peek([TOKENS.BRACE_OPEN])) {\n      consume([TOKENS.BRACE_OPEN]);\n      const block = NestedLogicBlocks();\n\n      if (!root) {\n        root = block.root;\n        wrapper = block.wrapper;\n      } else {\n        wrapper.content = block.wrapper;\n        wrapper = block.wrapper;\n      }\n\n      consume([TOKENS.LINE_BREAK]);\n    }\n\n    if (currentToken.token === TOKENS.INDENT || peek([TOKENS.INDENT])) {\n      if (currentToken.token !== TOKENS.INDENT) {\n        consume([TOKENS.INDENT])\n      }\n\n      lines = lines.concat(Lines());\n      if (!mainItem) {\n        mainItem = lines[0];\n      }\n      consume([TOKENS.DEDENT, TOKENS.EOF])\n    }\n\n    const node = OptionNode(\n      ContentNode(lines),\n      type,\n      mainItem.value,\n      mainItem.id,\n      mainItem.speaker,\n      mainItem.tags,\n    );\n\n    if (root) {\n      wrapper.content = node;\n      return root;\n    }\n\n    return node;\n  }\n\n  const NestedLogicBlocks = () => {\n    let root\n    let wrapper\n    while (currentToken.token === TOKENS.BRACE_OPEN) {\n      if (!root) {\n        root = LogicBlock();\n        wrapper = root;\n      } else {\n        let next = LogicBlock();\n        wrapper.content = next;\n        wrapper = next;\n      }\n      if (peek([TOKENS.BRACE_OPEN])) {\n        consume([TOKENS.BRACE_OPEN]);\n      }\n    }\n    return { root, wrapper };\n  };\n\n\n  const Divert = () => {\n    consume([ TOKENS.DIVERT, TOKENS.DIVERT_PARENT ]);\n    const divert = currentToken;\n    let token\n\n    switch (divert.token) {\n      case TOKENS.DIVERT:\n        token = DivertNode(divert.value);\n        break;\n      case TOKENS.DIVERT_PARENT:\n        token = DivertNode('<parent>');\n        break;\n    }\n\n    if (peek([TOKENS.LINE_BREAK])) {\n      consume([TOKENS.LINE_BREAK]);\n      return token;\n    }\n\n    if (peek([TOKENS.EOF])) {\n      return token;\n    }\n\n    if (peek([TOKENS.BRACE_OPEN])) {\n      consume([TOKENS.BRACE_OPEN]);\n      token = LineWithAction(token);\n    }\n\n    return token\n  };\n\n  const Variations = () => {\n    const variations = VariationsNode('cycle');\n\n    if (peek([TOKENS.VARIATIONS_MODE])) {\n      const mode = consume([TOKENS.VARIATIONS_MODE]);\n      if (!variationsModes.includes(mode.value)) {\n        throw new Error(`Wrong variation mode set \"${mode.value}\". Valid modes: ${variationsModes.join(', ')}.`);\n      };\n      variations.mode = mode.value;\n    }\n\n    while(peek([TOKENS.INDENT, TOKENS.MINUS])) {\n      if (peek([TOKENS.INDENT])) {\n        consume([TOKENS.INDENT]);\n        continue;\n      }\n      consume([TOKENS.MINUS])\n\n      let startsNextLine = false;\n      if (peek([TOKENS.INDENT])) {\n        consume([TOKENS.INDENT]);\n        startsNextLine = true;\n      }\n\n      variations.content.push(ContentNode(Lines()));\n      if (startsNextLine) {\n        const lastVariation = variations.content[variations.content.length - 1].content;\n        const lastContent = lastVariation[lastVariation.length - 1];\n        if (lastContent.type !== 'options') {\n          consume([TOKENS.DEDENT]);\n        }\n      }\n\n      if (peek([TOKENS.DEDENT])) {\n        consume([TOKENS.DEDENT]);\n      }\n    }\n    consume([TOKENS.BRACKET_CLOSE]);\n\n    return variations;\n  };\n\n  const LineWithAction = (line) => {\n    const token = peek([\n      TOKENS.KEYWORD_SET,\n      TOKENS.KEYWORD_TRIGGER,\n    ]);\n    const expression = LogicElement();\n\n    if (line) {\n      let content = line;\n\n      if (peek([TOKENS.BRACE_OPEN])) {\n        consume([TOKENS.BRACE_OPEN]);\n        content = LineWithAction(line);\n      }\n\n      if (peek([TOKENS.LINE_BREAK])) {\n        consume([TOKENS.LINE_BREAK]);\n      }\n\n      if (!token || token.token === TOKENS.KEYWORD_WHEN) {\n        return ConditionalContentNode(expression, content);\n      }\n      return ActionContentNode(expression, content);\n    }\n\n    if (peek([TOKENS.LINE_BREAK])) {\n      consume([TOKENS.LINE_BREAK]);\n      return expression;\n    }\n\n    if (peek([TOKENS.EOF])) {\n      return  expression;\n    }\n\n    if (peek([TOKENS.BRACE_OPEN])) {\n      consume([TOKENS.BRACE_OPEN]);\n      if (!token) {\n        return ConditionalContentNode(expression, LineWithAction());\n      }\n      return ActionContentNode(expression, LineWithAction());\n    }\n\n    consume([TOKENS.SPEAKER, TOKENS.TEXT]);\n\n    if (!token) {\n      return ConditionalContentNode(expression, Line());\n    }\n    return ActionContentNode(expression, Line());\n  };\n\n  const LogicElement = () => {\n    if (peek([TOKENS.KEYWORD_SET])) {\n      const assignments = Assignments()\n      return assignments\n    }\n\n    if (peek([TOKENS.KEYWORD_TRIGGER])) {\n      const events = Events();\n      return events;\n\n    }\n\n    if (peek([TOKENS.KEYWORD_WHEN])) {\n      consume([TOKENS.KEYWORD_WHEN]);\n    }\n\n    const condition = Condition();\n    return condition;\n  };\n\n  const LogicBlock = () => {\n    if (peek([TOKENS.KEYWORD_SET])) {\n      const assignments = Assignments()\n      return ActionContentNode(assignments);\n    }\n\n    if (peek([TOKENS.KEYWORD_TRIGGER])) {\n      const events = Events();\n      return ActionContentNode(events);\n\n    }\n\n    if (peek([TOKENS.KEYWORD_WHEN])) {\n      consume([TOKENS.KEYWORD_WHEN]);\n    }\n\n    const condition = Condition();\n    return ConditionalContentNode(condition);\n  };\n\n\n  const Assignments = () => {\n    consume([TOKENS.KEYWORD_SET]);\n    const assignments = [AssignmentExpression()];\n    while(peek([TOKENS.COMMA])) {\n      consume([TOKENS.COMMA]);\n      assignments.push(AssignmentExpression());\n    }\n    consume([TOKENS.BRACE_CLOSE]);\n    return AssignmentsNode(assignments);\n  };\n\n  const Events = () => {\n    consume([TOKENS.KEYWORD_TRIGGER]);\n    consume([TOKENS.IDENTIFIER]);\n    const events = [EventNode(currentToken.value)];\n\n    while(peek([TOKENS.COMMA])) {\n      consume([TOKENS.COMMA]);\n      consume([TOKENS.IDENTIFIER]);\n      events.push(EventNode(currentToken.value));\n    }\n\n    consume([TOKENS.BRACE_CLOSE]);\n\n    return EventsNode(events);\n  };\n\n  const ConditionalLine = () => {\n    const expression = Condition();\n\n    let content;\n\n    if (peek([TOKENS.DIVERT, TOKENS.DIVERT_PARENT])) {\n      content = Divert();\n    } else if (peek([TOKENS.LINE_BREAK])) {\n      consume([TOKENS.LINE_BREAK]);\n      consume([TOKENS.INDENT]);\n      content = ContentNode(Lines());\n      consume([TOKENS.DEDENT, TOKENS.EOF]);\n    } else if (peek([TOKENS.BRACE_OPEN])) {\n      consume([TOKENS.BRACE_OPEN]);\n      content = LineWithAction();\n    } else {\n      consume([TOKENS.SPEAKER, TOKENS.TEXT]);\n      content = Line();\n      if (peek([TOKENS.BRACE_OPEN])) {\n        consume([TOKENS.BRACE_OPEN]);\n        content = LineWithAction(content);\n      }\n    }\n\n    return ConditionalContentNode(\n      expression,\n      content\n    );\n  };\n\n  const Condition = () => {\n    const token = peek([\n      TOKENS.IDENTIFIER,\n      TOKENS.NOT,\n    ]);\n    let expression;\n    if (token) {\n      expression = Expression();\n    }\n    consume([TOKENS.BRACE_CLOSE]);\n    return expression;\n  };\n\n  const AssignmentExpression = () => {\n    consume([TOKENS.IDENTIFIER]);\n    const variable = VariableNode(currentToken.value);\n\n    if (peek([TOKENS.BRACE_CLOSE])) {\n      return variable;\n    }\n\n    const operators = Object.keys(assignmentOperators);\n\n    consume(operators);\n\n    if (peek([TOKENS.IDENTIFIER]) && peek([...operators, TOKENS.BRACE_CLOSE], 1)) {\n      return AssignmentNode(variable, assignmentOperators[currentToken.token], AssignmentExpression());\n    }\n    return AssignmentNode(variable, assignmentOperators[currentToken.token], Expression());\n  };\n\n  const Expression = (minPrecedence = 1) => {\n    const operatorTokens = Object.keys(operators);\n\n    let lhs = Operand();\n\n    if (!peek(operatorTokens)) {\n      return lhs;\n    }\n\n    consume(operatorTokens);\n\n    while (true) {\n      if (!operatorTokens.includes(currentToken.token)) {\n        break;\n      }\n\n      const operator = currentToken.token;\n\n      const { precedence, associative } = operators[currentToken.token];\n\n      if (precedence < minPrecedence) {\n        break;\n      }\n\n      const nextMinPrecedence = associative === 'LEFT' ? precedence + 1 : precedence;\n      const rhs = Expression(nextMinPrecedence);\n      lhs = Operator(operator, lhs, rhs);\n    }\n    return lhs;\n  };\n\n  const Operand = () => {\n    consume([\n      TOKENS.IDENTIFIER,\n      TOKENS.NOT,\n      TOKENS.NUMBER_LITERAL,\n      TOKENS.STRING_LITERAL,\n      TOKENS.BOOLEAN_LITERAL,\n      TOKENS.NULL_TOKEN\n    ]);\n\n    switch(currentToken.token) {\n      case TOKENS.NOT:\n        return ExpressionNode('not', [Operand()]);\n      case TOKENS.IDENTIFIER:\n        return VariableNode(currentToken.value);\n      case TOKENS.NUMBER_LITERAL:\n        return NumberLiteralNode(currentToken.value);\n      case TOKENS.STRING_LITERAL:\n        return StringLiteralNode(currentToken.value);\n      case TOKENS.BOOLEAN_LITERAL:\n        return BooleanLiteralNode(currentToken.value);\n      case TOKENS.NULL_TOKEN:\n        return NullTokenNode();\n    }\n  };\n\n  const Operator = (operator, lhs, rhs) => {\n    const labels = {\n      [TOKENS.PLUS]: 'add',\n      [TOKENS.MINUS]: 'sub',\n      [TOKENS.MULT]: 'mult',\n      [TOKENS.DIV]: 'div',\n      [TOKENS.MOD]: 'mod',\n      [TOKENS.POWER]: 'pow',\n      [TOKENS.AND]: 'and',\n      [TOKENS.OR]: 'or',\n      [TOKENS.EQUAL]: 'equal',\n      [TOKENS.NOT_EQUAL]: 'not_equal',\n      [TOKENS.GREATER]: 'greater_than',\n      [TOKENS.LESS]: 'less_than',\n      [TOKENS.GE]: 'greater_or_equal',\n      [TOKENS.LE]: 'less_or_equal',\n    };\n    return ExpressionNode(labels[operator], [lhs, rhs]);\n  };\n\n  const result = Document();\n  if (peek()) {\n    consume([ TOKENS.EOF ]);\n  }\n  return result;\n}\n","import styled from 'styled-components';\n\nexport const InfoBubble = styled.div `\n  text-align: center;\n  width: auto;\n  background-color: #eeeeee;\n  margin: 10px 10px;\n  padding: 10px 20px;\n  border-radius: 5px;\n  cursor: default;\n`;\n\nexport const ErrorBubble = styled.div`\n  text-align: center;\n  width: auto;\n  background-color: #ffeeee;\n  margin: 10px 10px;\n  padding: 30px 20px;\n  border-radius: 5px;\n  cursor: default;\n  font-weight: 500;\n  display: flex;\n  justify-content: center;\n  white-space: pre-line;\n  line-height: 26px;\n`;\n","import React from \"react\";\nimport styled from 'styled-components';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport {\n  faRedoAlt,\n  faFastForward,\n  faBug,\n  faComment,\n  faComments,\n  faReceipt,\n  faGhost,\n  faHandSparkles,\n} from '@fortawesome/free-solid-svg-icons'\n\nconst InterpreterToolbarWrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  color: #444;\n  padding: 0px 10px;\n  height: 40px;\n\n  > svg {\n    cursor: pointer;\n    font-size: 1.5em;\n    margin: 0px 20px;\n    &:hover {\n      color: #555;\n    }\n  }\n`;\n\n\nexport default function InterpreterToolbar(properties) {\n  const {\n    doc,\n    currentBlock,\n    shouldShowExtraMetadata,\n    shouldShowDebugPane,\n    singleBubblePresentation,\n    setBlock,\n    clearTimeline,\n    showExtraMetadata,\n    hideExtraMetadata,\n    showDebugPane,\n    hideDebugPane,\n    enableSingleBubbleDialogue,\n    disableSingleBubbleDialogue,\n    dialogue,\n    addDialogueLine,\n    chooseOption,\n    clearEvents,\n  } = properties;\n\n  const selectBlock = (blockName) => {\n    setBlock(blockName);\n    clearTimeline();\n    dialogue.start(blockName);\n  };\n\n  const toggleMultipleBubbles = () => {\n    if (singleBubblePresentation) {\n      disableSingleBubbleDialogue();\n    } else {\n      enableSingleBubbleDialogue();\n    }\n  };\n\n  const toggleExtraMetadata = () => {\n    if (shouldShowExtraMetadata) {\n      hideExtraMetadata();\n    } else {\n      showExtraMetadata();\n    }\n  };\n\n  const toggleDebugPane = () => {\n    if (shouldShowDebugPane) {\n      hideDebugPane();\n    } else {\n      showDebugPane();\n    }\n  };\n\n  const restart = () => {\n    dialogue.start(currentBlock);\n    clearTimeline();\n  };\n\n  const forwardToNextOption = () => {\n    const line = dialogue.getContent();\n    addDialogueLine(line);\n\n    if (!line || line.type === 'options') {\n      return line;\n    }\n\n    return forwardToNextOption();\n  };\n\n  const poltergeist = () => {\n    const optionList = forwardToNextOption();\n\n    if (!optionList) {\n      return;\n    }\n\n    const choice = Math.floor(Math.random() * optionList.options.length);\n    chooseOption(choice);\n    dialogue.choose(choice);\n\n    poltergeist();\n  };\n\n  const cleanMemory = () => {\n    dialogue.clearData();\n    addDialogueLine({ type: 'INTERPRETER_INFO', text: 'Memory cleared'})\n    dialogue.start(currentBlock);\n    clearEvents();\n    clearTimeline();\n  };\n\n  return (\n    <InterpreterToolbarWrapper>\n      <BlockList document={doc} currentBlock={currentBlock} onBlockSelected={selectBlock}/>\n      <FontAwesomeIcon icon={faRedoAlt} title=\"Restart dialogue\" onClick={restart}/>\n\n      <FontAwesomeIcon icon={faFastForward} title=\"Forward untill next choice\" onClick={forwardToNextOption}/>\n\n      <FontAwesomeIcon icon={faGhost} title=\"Execute Poltergeist mode (auto anwser)\" onClick={poltergeist}/>\n\n      <FontAwesomeIcon icon={faHandSparkles} title=\"Clear memory\" onClick={cleanMemory}/>\n\n      <FontAwesomeIcon\n        icon={ singleBubblePresentation ? faComments : faComment }\n        title={`Set ${singleBubblePresentation ? 'multi' : 'single'} bubble dialogue`}\n        onClick={toggleMultipleBubbles}\n      />\n\n      <FontAwesomeIcon icon={faReceipt} onClick={toggleExtraMetadata} title={`${shouldShowExtraMetadata ? 'Hide' : 'Show'} metadata`}/>\n\n      <FontAwesomeIcon icon={faBug} onClick={toggleDebugPane} title={`${shouldShowDebugPane ? 'Hide' : 'Show'} debug pane`}/>\n    </InterpreterToolbarWrapper>\n  );\n}\n\nfunction BlockList(props) {\n  const { document: doc, currentBlock, onBlockSelected } = props;\n  const list = [\n    ...(doc.content.length > 0 ? ['default'] : []),\n    ...doc.blocks.map(b => b.name)\n  ];\n\n  const selectBlock = (event) => {\n    const { value } = event.target;\n    if (value === 'default') {\n      onBlockSelected();\n      return;\n    }\n    onBlockSelected(event.target.value);\n  };\n\n  return (\n    <div>\n      <select value={currentBlock} onChange={selectBlock} aria-label=\"Block selector\">\n        { list.map((option, index) => (\n            <option key={index} value={option}>{option}</option>\n          )\n        )}\n      </select>\n    </div>\n  );\n}\n\n","import React from \"react\";\nimport styled from 'styled-components';\n\nimport { InfoBubble } from './Bubbles';\n\nconst DialogueBubble = styled.div`\n  width: auto;\n  background-color: #fff5da;\n  color: #34383c;\n  margin: 10px 10px;\n  padding: 10px 20px;\n  border-radius: 5px;\n  cursor: default;\n  position: relative;\n`;\n\nconst DialogueContent = styled.div`\n`;\n\nconst DialogueSpeaker = styled.div`\n  margin-bottom: 5px;\n  font-weight: 500;\n`;\n\nconst DialogueOptionsList = styled.ol`\n  margin-left: 10px;\n  list-style-type: decimal;\n  list-style-position: inside;\n`;\n\nconst DialogueOption = styled.li`\n  position: relative;\n  opacity: ${p => p.optionSelected !== undefined && p.optionSelected !== p.index ? 0.5 : 1 };\n  ${p => p.optionSelected === p.index ? 'font-weight: 600;' : '' }\n  cursor: ${p => p.optionSelected === undefined ? 'pointer' : 'default' };\n  margin: 4px;\n\n  > span:hover {\n    ${p => p.optionSelected !== undefined ? '' : 'font-weight: 600;' }\n  }\n`;\n\nconst DialogueMetadataWrapper = styled.span`\n  color: #444;\n  font-weight: normal;\n  background-color: rgba(245,235,208, 1);\n  opacity: 0.8;\n  border-radius: 5px;\n  padding-right: 10px;\n  margin-left: 10px;\n\n  label {\n    margin-left: 10px;\n    font-weight: 500;\n  }\n`;\n\nexport default function DialogueEntry(props) {\n  const {\n    line,\n    onSelection,\n    showMetadata\n  } = props;\n\n  if (line === undefined) {\n    return <InfoBubble>DIALOGUE ENDED</InfoBubble>;\n  }\n\n  if (line.type === 'line') {\n    return <DialogueLine {...line} showMetadata={showMetadata}/>\n  }\n\n  if (line.type === 'options') {\n    return <DialogueOptions {...line} onSelection={onSelection} showMetadata={showMetadata}/>\n  }\n\n  return <InfoBubble>{line.text === '<DIALOGUE_CHANGED>' ? 'DIALOGUE CHANGED' : line.text }</InfoBubble>\n}\n\nfunction DialogueLine(props) {\n  const {\n    id,\n    tags,\n    speaker,\n    text,\n    showMetadata\n  } = props;\n\n  return (\n    <DialogueBubble>\n      { speaker ? <DialogueSpeaker>{speaker}</DialogueSpeaker> : undefined }\n      <DialogueContent>\n        {text} <DialogueMetadata id={id} tags={tags} isVisible={showMetadata}/>\n      </DialogueContent>\n    </DialogueBubble>\n  );\n}\n\nfunction DialogueOptions(props) {\n  const {\n    id,\n    tags,\n    speaker,\n    name,\n    options,\n    onSelection,\n    selected,\n    showMetadata\n  } = props;\n\n  const select = (option) => {\n    if (selected !== undefined) {\n      return;\n    }\n    onSelection(option);\n  };\n\n  return (\n    <DialogueBubble>\n      { speaker ? <DialogueSpeaker>{speaker}</DialogueSpeaker> : undefined }\n      <DialogueContent>\n        {name} <DialogueMetadata id={id} tags={tags} isVisible={showMetadata}/>\n        <DialogueOptionsList>\n          { options.map((option, index) => (\n            <DialogueOption\n              key={index}\n              optionSelected={selected}\n              index={index}\n            >\n              <span onClick={e => { e.stopPropagation(); select(index) }}>{option.label} <DialogueMetadata {...option} isVisible={showMetadata}/></span>\n\n            </DialogueOption>\n            ))}\n        </DialogueOptionsList>\n      </DialogueContent>\n    </DialogueBubble>\n  );\n}\n\nfunction DialogueMetadata({ id, tags, isVisible }) {\n  if (!isVisible || (id === undefined && tags === undefined )) {\n    return<span></span>;\n  }\n\n  return <DialogueMetadataWrapper aria-label=\"metadata\">\n    { id !== undefined ? <span aria-label=\"line id\"><label>id:</label> {id}</span>: undefined } { tags !== undefined ? <span aria-label=\"line tags\"><label>tags:</label> {tags.join(', ')}</span>: undefined }\n  </DialogueMetadataWrapper>\n}\n\n","import React, { useRef, useEffect } from \"react\";\nimport styled from 'styled-components';\n\nimport { InfoBubble } from './Bubbles';\nimport DialogueEntry from './DialogueEntry';\n\nconst InterpreterScreenWrapper = styled.div`\n  width: auto;\n  overflow: scroll;\n`;\n\nexport default function InterpreterTimeline(props) {\n  const {\n    timeline,\n    shouldShowExtraMetadata,\n    singleBubblePresentation,\n    addDialogueLine,\n    style,\n    dialogue,\n    chooseOption,\n  } = props;\n\n  const next = () => {\n    const line = dialogue.getContent();\n    if (line && line.type === 'options' && timeline.length > 0 && timeline[timeline.length - 1].type === 'options') {\n      return;\n    }\n\n    if (!line && !timeline[timeline.length - 1]) {\n      return;\n    }\n    addDialogueLine(line);\n  };\n\n  const choose = (option) => {\n    dialogue.choose(option);\n    chooseOption(option);\n    next();\n  };\n\n  const scrollableRef = useRef(null)\n\n  const scrollToBottom = () => {\n    scrollableRef.current.scrollIntoView({ behavior: \"smooth\" })\n  }\n\n  useEffect(scrollToBottom, [timeline]);\n\n  return (\n      <InterpreterScreenWrapper onClick={next} style={style} aria-label=\"Interpreter Dialogue Timeline\">\n        {!timeline || !timeline.length ? <InfoBubble>Dialogue not started. Click for next line.</InfoBubble> : ''}\n        {\n          singleBubblePresentation ?\n            ( timeline.length ?  <DialogueEntry line={timeline[timeline.length - 1]} onSelection={choose} showMetadata={shouldShowExtraMetadata} /> : undefined )\n          :\n            timeline\n              .filter((line, key) => !(line && line.text === '<DIALOGUE_CHANGED>' && line.text === timeline[key - 1]?.text))\n              .map((line, key) => {\n                return <DialogueEntry line={line} key={key} onSelection={choose} showMetadata={shouldShowExtraMetadata}/>\n            })\n        }\n        <div ref={scrollableRef}/>\n      </InterpreterScreenWrapper>\n  );\n}\n\n","import React  from \"react\";\nimport styled from 'styled-components';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport {\n  // faSave,\n  faTimes,\n} from '@fortawesome/free-solid-svg-icons'\n\nconst DebugPaneWrapper = styled.div`\n  position: relative;\n  display: flex;\n  justify-content: center;\n  overflow: scroll;\n`;\n\nconst DebugPaneCloseButton = styled.div`\n  position: absolute;\n  top: 5px;\n  right: 5px;\n  cursor: pointer;\n`;\n\nconst DebugEntryTable = styled.table`\n  width: 90%;\n  margin: 10px;\n\n  thead > tr > td {\n    font-weight: 500;\n    padding-bottom: 5px;\n  }\n\n  tbody {\n    > tr:nth-child(even) {\n      background-color: #f3f3f3;\n    }\n    td {\n      padding: 2px 0px;\n    }\n  }\n`;\n\nexport default function DebugPane(properties) {\n  const {\n    events,\n    hideDebugPane,\n    ...props\n  } = properties;\n\n\n  const entries = events.reduce((entries, event) => {\n    const identifier = `${event.type}${event.data.name}`;\n    let record = entries[identifier];\n    if (!record) {\n      entries[identifier] = {\n        type: event.type,\n        name: event.data.name,\n        value: event.data.value,\n        eventTime: event.eventTime,\n      }\n      return entries;\n    }\n    record.eventTime = event.eventTime;\n\n    if (event.data.value) {\n      record.value = event.data.value;\n    }\n    return entries;\n  }, {});\n\n  const formatDate = (timestamp) => {\n    const date = new Date(timestamp);\n    return `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()} ${date.toLocaleTimeString()}`;\n  };\n\n  return <DebugPaneWrapper aria-label=\"Debug pane\" {...props}>\n    <DebugPaneCloseButton>\n      <FontAwesomeIcon icon={faTimes} onClick={hideDebugPane} aria-label=\"Close debug pane\"/>\n    </DebugPaneCloseButton>\n\n    <DebugEntryTable>\n      <thead>\n        <tr>\n          <td>Type</td>\n          <td>Name</td>\n          <td>Value</td>\n          <td>Time</td>\n        </tr>\n      </thead>\n      <tbody>\n    {Object.keys(entries).map((key) => {\n      const entry = entries[key];\n      return <tr key={key}><td>{entry.type}</td><td>{entry.name}</td><td>{entry.value !== undefined ? entry.value.toString() : undefined}</td><td>{formatDate(entry.eventTime)}</td></tr>;\n    })}\n     </tbody>\n    </DebugEntryTable>\n  </DebugPaneWrapper>;\n}\n","import React, { useState } from \"react\";\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nimport { Interpreter as ClydeInterpreter } from '@clyde-lang/interpreter';\nimport { parse } from '@clyde-lang/parser';\n\nimport { InfoBubble, ErrorBubble } from './Bubbles';\nimport InterpreterToolbar from './InterpreterToolbar';\nimport InterpreterTimeline from './InterpreterTimeline';\nimport DebugPane from './DebugPane';\n\nimport SplitPane from '../screens/SplitPane';\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport default function Interpreter(p) {\n  const {\n    content,\n    currentBlock,\n    timeline,\n    shouldShowExtraMetadata,\n    shouldShowDebugPane,\n    debugPaneDirection = \"horizontal\",\n    singleBubblePresentation,\n    clydeDocument,\n    setBlock,\n    addDialogueLine,\n    clearTimeline,\n    showExtraMetadata,\n    hideExtraMetadata,\n    showDebugPane,\n    hideDebugPane,\n    enableSingleBubbleDialogue,\n    disableSingleBubbleDialogue,\n    chooseOption,\n    notifyEvent,\n    clearEvents,\n    events,\n    ...props } = p;\n  const [lastContent, setLastContent] = useState('');\n  const [persistedDialogue, setDialogue] = useState();\n  let dialogue = persistedDialogue;\n  let doc;\n  let errorMessage;\n\n  const updateEventInfo = (data) => {\n    updateDebugInfo('event', data);\n  };\n\n  const updateVariableInfo = (data) => {\n    updateDebugInfo('variable', data);\n  };\n\n  const updateDebugInfo = (type, data) => {\n    notifyEvent({ type, data, eventTime: Date.now() });\n  };\n\n  try {\n    doc = parse(`${content || ''}`);\n\n    if (!dialogue || content !== lastContent) {\n      setLastContent(content);\n      dialogue = ClydeInterpreter(doc);\n      if (currentBlock) {\n        dialogue.start(currentBlock);\n        setBlock(currentBlock);\n      }\n      setDialogue(dialogue);\n\n      dialogue.on(dialogue.events.VARIABLE_CHANGED, updateVariableInfo);\n      dialogue.on(dialogue.events.EVENT_TRIGGERED, updateEventInfo);\n    }\n  } catch (e) {\n    errorMessage = e.message;\n    doc = parse(`${lastContent || ''}`);\n  }\n\n  return (\n    <Wrapper {...props} aria-label=\"Clyde interpreter\">\n      <InterpreterToolbar\n        doc={doc}\n        currentBlock={currentBlock}\n        timeline={timeline}\n        shouldShowExtraMetadata={shouldShowExtraMetadata}\n        shouldShowDebugPane={shouldShowDebugPane}\n        singleBubblePresentation={singleBubblePresentation}\n        setBlock={setBlock}\n        clearTimeline={clearTimeline}\n        showExtraMetadata={showExtraMetadata}\n        hideExtraMetadata={hideExtraMetadata}\n        showDebugPane={showDebugPane}\n        hideDebugPane={hideDebugPane}\n        enableSingleBubbleDialogue={enableSingleBubbleDialogue}\n        disableSingleBubbleDialogue={disableSingleBubbleDialogue}\n        addDialogueLine={addDialogueLine}\n        dialogue={dialogue}\n        chooseOption={chooseOption}\n        clearEvents={clearEvents}\n      />\n\n      <SplitPane\n        direction={debugPaneDirection}\n        defaultSizes={[80, 20]}\n        style={{height: 'calc(100% - 40px)'}}\n       >\n        { !errorMessage && content && content !== '' ?\n          <InterpreterTimeline\n            dialogue={dialogue}\n            currentBlock={currentBlock}\n            timeline={timeline}\n            shouldShowExtraMetadata={shouldShowExtraMetadata}\n            singleBubblePresentation={singleBubblePresentation}\n            setBlock={setBlock}\n            addDialogueLine={addDialogueLine}\n            clearTimeline={clearTimeline}\n            chooseOption={chooseOption}\n            />\n            : (errorMessage ? <ErrorBubble style={{ backgroundColor: '#eeefef' }}>{errorMessage}</ErrorBubble> :  <InfoBubble>Nothing to show.</InfoBubble>)}\n\n        { shouldShowDebugPane ?\n            <DebugPane events={events} hideDebugPane={hideDebugPane}/>\n        : undefined }\n      </SplitPane>\n    </Wrapper>\n  );\n}\n\nInterpreter.propTypes = {\n  currentBlock: PropTypes.string,\n  timeline: PropTypes.array,\n  shouldShowExtraMetadata: PropTypes.bool,\n  shouldShowDebugPane: PropTypes.bool,\n  singleBubblePresentation: PropTypes.bool,\n  clydeDocument: PropTypes.string,\n  setBlock: PropTypes.func,\n  addDialogueLine: PropTypes.func,\n  clearTimeline: PropTypes.func,\n  showExtraMetadata: PropTypes.func,\n  hideExtraMetadata: PropTypes.func,\n  showDebugPane: PropTypes.func,\n  hideDebugPane: PropTypes.func,\n  enableSingleBubbleDialogue: PropTypes.func,\n  disableSingleBubbleDialogue: PropTypes.func,\n};\n","import { LogicInterpreter } from'./logic_interpreter.js';\nimport { Memory } from './memory.js';\nimport { Events, events } from './events.js';\n\nexport { events } from './events.js';\n\n/**\n * Clyde Interpreter\n *\n * @param {Object} doc - Clyde Object\n * @param {Object} data - Internal data to be loaded\n * @param {Object} dictionary - Translation object with key values\n *\n * @return {Interpreter} Interpreter instance\n */\nexport function Interpreter(doc, data, dictionary = {}) {\n  let textDictionary = dictionary;\n  const anchors = {\n  };\n  const listeners = Events();\n  const mem = Memory(listeners, data);\n  let stack;\n  const logic = LogicInterpreter(mem);\n\n\n  doc._index = 1;\n  doc.blocks.forEach((block, index) => {\n    block._index = index + 2;\n    anchors[block.name] = block;\n  });\n\n  const initializeStack = (root = doc) => {\n    stack = [{\n      current: root,\n      contentIndex: -1\n    }]\n  };\n\n  const nodeHandlers = {\n    'document': () => handleDocumentNode(),\n    'content': node => handleContentNode(node),\n    'options': node => handleOptionsNode(node),\n    'option': node => handleOptionNode(node),\n    'line': node => handleLineNode(node),\n    'action_content': node => handleActionContent(node),\n    'conditional_content': (node, fallback) => handleConditionalContent(node, fallback),\n    'variations': node => handleVariations(node),\n    'block': node => handleBlockNode(node),\n    'divert': node => handleDivert(node),\n    'assignments': node => handleAssignementNode(node),\n    'events': node => handleEventNode(node),\n    'error': node => { throw new Error(`Unkown node type \"${node.type}\"`) },\n  };\n\n  const variationHandlers = {\n    'cycle': (variations) => {\n      let current = mem.getInternalVariable(variations._index, -1);\n      if (current < variations.content.length - 1) {\n        current += 1;\n      } else {\n        current = 0\n      }\n      mem.setInternalVariable(variations._index, current);\n      return current;\n    },\n    'once': (variations) => {\n      const current = mem.getInternalVariable(variations._index, -1);\n      const index = current + 1;\n      if (index <= variations.content.length - 1) {\n        mem.setInternalVariable(variations._index, index);\n        return index;\n      }\n      return -1;\n    },\n    'sequence': (variations) => {\n      let current = mem.getInternalVariable(variations._index, -1);\n      if (current < variations.content.length - 1) {\n        current += 1;\n        mem.setInternalVariable(variations._index, current);\n      }\n      return current;\n    },\n    'shuffle': (variations, mode = 'cycle' ) => {\n      const SHUFFLE_VISITED_KEY = `${variations._index}_shuffle_visited`;\n      const LAST_VISITED_KEY = `${variations._index}_last_index`;\n      let visitedItems = mem.getInternalVariable(SHUFFLE_VISITED_KEY, []);\n      const remainingOptions = variations.content.filter(a => !visitedItems.includes(a._index));\n\n      if (remainingOptions.length === 0) {\n        if (mode === 'once') {\n          return -1;\n        }\n        if (mode === 'cycle') {\n          mem.setInternalVariable(SHUFFLE_VISITED_KEY, []);\n          return variationHandlers['shuffle'](variations, mode);\n        }\n        return mem.getInternalVariable(LAST_VISITED_KEY, -1);\n      }\n\n      const random = Math.floor(Math.random() * remainingOptions.length);\n      const index = variations.content.indexOf(remainingOptions[random]);\n\n      visitedItems.push(remainingOptions[random]._index);\n\n      mem.setInternalVariable(LAST_VISITED_KEY, index);\n      mem.setInternalVariable(SHUFFLE_VISITED_KEY, visitedItems);\n\n      return index;\n    },\n    'shuffle sequence': (variations) => {\n      return variationHandlers['shuffle'](variations, 'sequence');\n    },\n    'shuffle once': (variations) => {\n      return variationHandlers['shuffle'](variations, 'once');\n    },\n    'shuffle cycle': (variations) => {\n      return variationHandlers['shuffle'](variations, 'cycle');\n    }\n  };\n\n  const handleNextNode = (node, fallback) => (nodeHandlers[node.type] || nodeHandlers['error'])(node, fallback);\n\n  const generateIndex = () => (10 * stackHead().current._index) + stackHead().contentIndex;\n\n  const addToStack = (node) => {\n    if (stackHead().current !== node) {\n      stack.push({\n        current: node,\n        contentIndex: -1\n      })\n    }\n  };\n\n  const handleDocumentNode = () => {\n    const node = stackHead();\n    const contentIndex = node.contentIndex + 1;\n    if (contentIndex < node.current.content.length) {\n      node.contentIndex = contentIndex\n      return handleNextNode(node.current.content[contentIndex]);\n    }\n  }\n\n  const handleContentNode = (contentNode) => {\n    if (stackHead().current !== contentNode) {\n      if (!contentNode._index) {\n        contentNode._index = generateIndex();\n      }\n      stack.push({\n        current: contentNode,\n        contentIndex: -1\n      })\n    }\n\n    const node = stackHead();\n    const contentIndex = node.contentIndex + 1;\n    if (contentIndex < node.current.content.length) {\n      node.contentIndex = contentIndex\n      return handleNextNode(node.current.content[contentIndex]);\n    }\n    stack.pop();\n    return handleNextNode(stackHead().current);\n  };\n\n  const handleBlockNode = (block) => {\n    addToStack(block);\n\n    const node = stackHead();\n    const contentIndex = node.contentIndex + 1;\n\n    if (contentIndex < node.current.content.content.length) {\n      node.contentIndex = contentIndex\n      return handleNextNode(node.current.content.content[contentIndex]);\n    }\n  };\n\n  const handleDivert = (divert) => {\n    if (divert.target === '<parent>') {\n\n      while (!['document', 'block', 'option', 'options'].includes(stackHead().current.type)) {\n        stack.pop();\n      }\n\n      if (stack.length > 1) {\n        stack.pop();\n        return handleNextNode(stackHead().current);\n      }\n    } else if (divert.target === '<end>') {\n      initializeStack();\n      stackHead().contentIndex = stackHead().current.content.length;\n    } else {\n      return handleNextNode(anchors[divert.target]);\n    }\n  };\n\n  const handleAssignementNode = (assignment) => {\n    assignment.assignments.forEach(logic.handleAssignement)\n    return handleNextNode(stackHead().current);\n  };\n\n  const handleEventNode = (events) => {\n    events.events.forEach(event => {\n      listeners.triggerEvent(\n        listeners.events.EVENT_TRIGGERED,\n        { name: event.name });\n    });\n    return handleNextNode(stackHead().current);\n  };\n\n  const handleOptionsNode = (optionsNode) => {\n    if (!optionsNode._index) {\n      optionsNode._index = generateIndex();\n      mem.setInternalVariable('OPTIONS_COUNT', optionsNode.content.length);\n    }\n    addToStack(optionsNode);\n    const options = getVisibleOptions(optionsNode);\n    mem.setInternalVariable('OPTIONS_COUNT', options.length);\n\n    if (options.length === 0) {\n      stack.pop();\n      return handleNextNode(stackHead().current);\n    }\n\n    if (options.length === 1 && options[0].mode === 'fallback') {\n      selectOption(0);\n      return handleNextNode(stackHead().current);\n    }\n\n    return {\n      type: 'options',\n      speaker: optionsNode.speaker,\n      id: optionsNode.id,\n      tags: optionsNode.tags,\n      name: replaceVariables(translateText(optionsNode.name, optionsNode.id)),\n      options: options.map(t => t.type === 'action_content' ? t.content : t).map((t) => ({\n        label: replaceVariables(translateText(t.name, t.id)),\n        speaker: t.speaker,\n        tags: t.tags,\n        id: t.id\n      }))\n    };\n  };\n\n  const handleOptionNode = (_optionNode) => {\n    // this is called when the contents inside the option\n    // were read. option list default behavior is to quit\n    // so we need to remove both option and option list from the stack.\n    stack.pop();\n    stack.pop();\n    return handleNextNode(stackHead().current);\n  };\n\n  const handleVariations = (variations, attempt = 0 ) => {\n    if (!variations._index) {\n      variations._index = generateIndex();\n      variations.content.forEach((c, index) => {\n        c._index = generateIndex() * 100 + index;\n      });\n    }\n\n    const next = variationHandlers[variations.mode](variations);\n\n    if (next === -1 || attempt > variations.content.length) {\n      return handleNextNode(stackHead().current);\n    }\n\n    if (variations.content[next].content.length === 1 && variations.content[next].content[0].type === 'conditional_content') {\n      if (!logic.checkCondition(variations.content[next].content[0].conditions)) {\n        return handleVariations(variations, attempt + 1);\n      }\n    }\n\n    return handleNextNode(variations.content[next]);\n  };\n\n\n  const handleLineNode = (lineNode) => {\n    if (!lineNode._index) {\n      lineNode._index = generateIndex();\n    }\n    return {\n      type: 'line',\n      tags: lineNode.tags,\n      id: lineNode.id,\n      speaker: lineNode.speaker,\n      text: replaceVariables(translateText(lineNode.value, lineNode.id))\n    };\n  }\n\n  const handleActionContent = (actionNode) => {\n    handleAction(actionNode);\n    return handleNextNode(actionNode.content);\n  };\n\n  const handleAction = (actionNode) => {\n    if (actionNode.action.type === 'events') {\n      actionNode.action.events.forEach(event => {\n        listeners.triggerEvent(\n          listeners.events.EVENT_TRIGGERED,\n          { name: event.name });\n      });\n    } else {\n      actionNode.action.assignments.forEach(logic.handleAssignement)\n    }\n  }\n\n  const handleConditionalContent = (conditionalNode, fallbackNode = stackHead().current) => {\n    if (logic.checkCondition(conditionalNode.conditions)) {\n      return handleNextNode(conditionalNode.content);\n    }\n    return handleNextNode(fallbackNode);\n  };\n\n  const selectOption = (contentIndex) => {\n    const node = stackHead();\n    if (node.current.type === 'options') {\n      const content = getVisibleOptions(node.current);\n\n      if (contentIndex >= content.length) {\n        throw new Error(`Index ${contentIndex} not available.`)\n      }\n\n      mem.setAsAccessed(content[contentIndex]._index);\n      mem.setInternalVariable('OPTIONS_COUNT', getVisibleOptions(node.current).length);\n      content[contentIndex].content._index = content[contentIndex]._index;\n\n      if (content[contentIndex].type === 'action_content') {\n        handleAction(content[contentIndex]);\n        addToStack(content[contentIndex].content);\n        addToStack(content[contentIndex].content.content);\n      } else {\n        addToStack(content[contentIndex]);\n        addToStack(content[contentIndex].content);\n      }\n\n    } else {\n      throw new Error('Nothing to select.');\n    }\n  }\n\n  const stackHead = () => stack[stack.length - 1];\n\n  const getVisibleOptions = (options) => {\n    return options.content\n      .map(prepareOption)\n      .filter((t) => {\n        return t && !(t.mode === 'once' && mem.wasAlreadyAccessed(t._index));\n      });\n  };\n\n  const prepareOption = (option, index) => {\n    if (!option._index) {\n      option._index = generateIndex() * 100 + index;\n    }\n\n    if (option.type === 'conditional_content') {\n      option.content._index = option._index;\n      if (logic.checkCondition(option.conditions)) {\n        return prepareOption(option.content, index)\n      }\n      return;\n    }\n\n    if (option.type === 'action_content') {\n      option.content._index = option._index;\n      option.mode = option.content.mode;\n      const content = prepareOption(option.content, index);\n      if (!content) {\n        return\n      }\n      return option;\n    }\n    return option;\n  };\n\n  const translateText = (text, id) => {\n    if (id && textDictionary[id]) {\n      return textDictionary[id];\n    }\n    return text;\n  };\n\n  const replaceVariables = (text) => {\n    if (text) {\n      (text.match(/\\%([A-z0-9]*)\\%/g) || [])\n        .map(match => {\n          const name = match.replace(/\\%/g, '');\n          let value;\n          value = mem.getVariable(name);\n          return { name: match, value };\n        })\n        .forEach( variable => {\n          text = text.replace(variable.name, variable.value === undefined ? '' : variable.value);\n        });\n    }\n    return text;\n  };\n\n  initializeStack();\n\n  /**\n   * Interpreter instance\n   *\n   * @typedef {Object} Interpreter\n   */\n  return {\n    events,\n\n    /**\n     * Add event listener\n     *\n     * @param {string} eventName - Event name\n     * @param {function} callback - Callback\n     * @return {function} callback\n     */\n    on(eventName, callback) {\n      return listeners.addListener(eventName, callback);\n    },\n\n    /**\n     * Remove event listener\n     *\n     * @param {string} eventName - Event name\n     * @param {function} callback - Callback provided when adding the listener\n     */\n    off(eventName, callback) {\n      listeners.removeListener(eventName, callback);\n    },\n\n    /**\n     * Get internal data\n     *\n     * @return {object} data\n     */\n    getData() {\n      return mem.getAll();\n    },\n\n    /**\n     * Load internal data\n     *\n     * @param {object} data\n     */\n    loadData(data) {\n      mem.load(data);\n    },\n\n    /**\n     * Clear all internal data\n     */\n    clearData() {\n      mem.clear();\n    },\n\n    /**\n     * Load translation object.\n     *\n     * @param {object} dictionary\n     */\n    loadDictionary(dictionary) {\n      textDictionary = dictionary;\n    },\n\n    /**\n     * Get next dialogue content\n     *\n     * @return {object} Content. Line, Option list or undefined.\n     */\n    getContent() {\n      return handleNextNode(stackHead().current)\n    },\n\n    /**\n     * Choose option by index. Option's index start in 0.\n     *\n     * @param {number} index - Option index\n     */\n    choose(index) {\n      return selectOption(index)\n    },\n\n    /**\n     * set variable\n     *\n     * @param {string} name - Variable name\n     * @param {string|number|boolean|undefined} value - Value\n     */\n    setVariable(name, value) {\n      mem.setVariable(name, value);\n    },\n\n    /**\n     * Return variable value\n     * @param {string} name - Variable name\n     * @return {string|number|boolean|undefined} variable value\n     */\n    getVariable(name) {\n      return mem.getVariable(name);\n    },\n\n    /**\n     * Start dialogue from the begining\n     *\n     * @param {string} [blockName] - Dialogue block to use\n     */\n    start(blockName) {\n      if (blockName) {\n        initializeStack(anchors[blockName]);\n      } else {\n        initializeStack();\n      }\n    }\n  }\n}\n\n","import React from 'react';\nimport styled from 'styled-components';\n\nconst ModalWrapper = styled.div`\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n`;\n\nconst ModalInnerWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  background-color: #fff;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n  min-width: 500px;\n  min-height: 300px;\n  color: #333;\n  padding: 10px;\n`;\n\nconst ModalHeader = styled.div`\n  margin-bottom: 10px;\n  padding-bottom: 10px;\n  text-align: center;\n  border-bottom: 1px solid #ccc;\n`;\n\nconst ModalFooter = styled.div`\n  text-align: right;\n`;\n\nconst ModalContent = styled.div`\n  flex-grow: 1;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst ModalAction = styled.button`\n  background-color: #fff;\n  border: 1px solid #ccc;\n  border-radius: 5px;\n  padding: 8px 12px;\n\n  &:focus, &:hover {\n    background-color: #f1f1f1;\n  }\n`;\n\nexport default function Modal(props) {\n  const {\n    title,\n    actions,\n    children\n  } = props;\n\n  return (\n    <ModalWrapper>\n      <ModalInnerWrapper>\n        <ModalHeader>{title}</ModalHeader>\n        <ModalContent>{children}</ModalContent>\n        <ModalFooter>\n          {actions.map((action, key) => {\n            return <ModalAction key={key} onClick={action.onClick}>{action.label}</ModalAction>\n          })}\n        </ModalFooter>\n      </ModalInnerWrapper>\n    </ModalWrapper>\n  );\n}\n","import React from 'react';\nimport styled from 'styled-components';\n\nimport Modal from '../screens/Modal';\n\nconst Preference = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 4px 10px;\n\n  > input {\n    margin-right: 10px;\n  }\n\n  > select, > input[type=\"number\"] {\n    margin-left: 10px;\n  }\n`;\n\nexport default function EditorSettingsModal(props) {\n  const {\n    onCloseClick,\n    updatePreference,\n    preferences,\n  } = props;\n\n  const update = (item) => {\n    updatePreference(item.target.name, item.target.checked);\n  };\n\n  const updateNumber = (item) => {\n    updatePreference(item.target.name, Number(item.target.value));\n  };\n\n  const updateTheme = (item) => {\n    updatePreference(item.target.name, item.target.value);\n  };\n\n  const themes = [\n    { value: 'dracula', name: 'Dracula' },\n    { value: 'monokai', name: 'Monokai' },\n    { value: 'tomorrow_night_eighties', name: 'Tomorrow Night Eighties' },\n    { value: 'tomorrow', name: 'Tomorrow' },\n    { value: 'textmate', name: 'Textmate' },\n  ];\n\n  return  (\n  <Modal title=\"Editor preferences\" actions={[{ label: 'Close', onClick: () => onCloseClick() }]}>\n    <Preference>\n      <input\n        type=\"checkBox\"\n        name=\"highlightActiveLine\"\n        onChange={update}\n        checked={preferences.highlightActiveLine}\n      />\n      <label htmlFor=\"highlightActiveLine\">Highlight active line</label>\n    </Preference>\n    <Preference>\n      <input type=\"checkBox\"  name=\"showInvisibles\"\n        onChange={update}\n        checked={preferences.showInvisibles}\n    />\n    <label htmlFor=\"showInvisibles\">Show invisibles</label>\n    </Preference>\n    <Preference>\n      <input type=\"checkBox\"  name=\"vimMode\"\n        onChange={update}\n        checked={preferences.vimMode}\n    />\n    <label htmlFor=\"vimMode\">Enable vim mode</label>\n    </Preference>\n    <Preference>\n      <input type=\"checkBox\"  name=\"lineWrap\"\n        onChange={update}\n        checked={preferences.lineWrap}\n      />\n      <label htmlFor=\"line_wrap\">Enable line wrap</label>\n    </Preference>\n    <Preference>\n      <input type=\"checkBox\"  name=\"scrollPastEnd\"\n        onChange={update}\n        checked={preferences.scrollPastEnd}\n      />\n      <label htmlFor=\"scrollPastEnd\"></label> Enable scroll past end\n    </Preference>\n    <Preference>\n      <input type=\"checkBox\"  name=\"useSoftTabs\"\n        onChange={update}\n        checked={preferences.useSoftTabs}\n      />\n      <label htmlFor=\"useSoftTabs\">Enable soft tabs</label>\n    </Preference>\n    <Preference>\n      <label htmlFor=\"tabSize\">Tab size</label>\n      <input type=\"number\"  name=\"tabSize\" max=\"10\" min=\"1\" onChange={updateNumber} value={preferences.tabSize}/>\n    </Preference>\n    <Preference>\n      <label htmlFor=\"fontSize\">Font size</label>\n      <input type=\"number\" name=\"fontSize\" max=\"70\" min=\"1\" onChange={updateNumber} value={preferences.fontSize}/>px\n    </Preference>\n    <Preference>\n      <label htmlFor=\"theme\">Theme</label>\n      <select name=\"theme\" value={preferences.theme} onChange={updateTheme}>\n        { themes.map((theme, key) => <option key={key} value={theme.value}>{theme.name}</option>)}\n      </select>\n    </Preference>\n  </Modal>\n  );\n}\n","import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport {\n  faCog,\n  faColumns,\n  faCode,\n  faEye,\n  faSlidersH,\n} from '@fortawesome/free-solid-svg-icons'\n\nimport SplitPane from './SplitPane';\nimport DropDownMenu, { DropDownItem } from './DropdownMenu';\n\nimport Editor from '../editor/Editor';\nimport Interpreter from '../interpreter/Interpreter';\nimport EditorSettingsModal from '../editor/EditorSettingsModal';\n\nconst Wrapper = styled.div`\n  height: 100%;\n  max-height: 100vh;\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  flex-direction: row;\n  height: 40px;\n  font-size: 1.5em;\n  color: #444;\n  padding-left: 10px;\n  align-items: center;\n`;\n\nconst IconWrapper = styled.span`\n  cursor: pointer;\n  position: relative;\n`;\n\nexport default function MainPanels(props) {\n  const {\n    // interface\n    isEditorEnabled = true,\n    isInterpreterEnabled = true,\n    toggleEditor,\n    toggleInterpreter,\n    interpreterSplitDirection = 'horizontal',\n    changeInterpreterSplitDirection,\n    // editor\n    editorDefaultValue,\n    setDocumentContent,\n    editorPreferences,\n    updateEditorPreference,\n    // interpreter\n    currentBlock,\n    timeline,\n    shouldShowExtraMetadata,\n    shouldShowDebugPane,\n    singleBubblePresentation,\n    document: clydeDocument,\n    setBlock,\n    addDialogueLine,\n    clearTimeline,\n    showExtraMetadata,\n    hideExtraMetadata,\n    showDebugPane,\n    hideDebugPane,\n    enableSingleBubbleDialogue,\n    disableSingleBubbleDialogue,\n    chooseOption,\n    events,\n    notifyEvent,\n    clearEvents,\n  } = props;\n\n  const [isMenuVisible, setMenuVisibility] = useState(false);\n  const [isEditorSettingsVisible, setEditorSettingsVisibility] = useState(false);\n\n  const toggleSplitDirection = () => {\n    if (interpreterSplitDirection === 'vertical') {\n      changeInterpreterSplitDirection('horizontal');\n    } else {\n      changeInterpreterSplitDirection('vertical');\n    }\n  };\n\n  const toggleMenu = () => {\n    setMenuVisibility(!isMenuVisible);\n  };\n\n  const openEditorSettings = () => {\n    setEditorSettingsVisibility(true);\n  };\n\n  return (\n     <Wrapper>\n       <Header>\n         <IconWrapper>\n           <FontAwesomeIcon icon={faCog} onClick={toggleMenu} aria-label=\"Toggle settings menu\"/>\n           { isMenuVisible ? (\n              <DropDownMenu onClick={toggleMenu}>\n                <DropDownItem\n                  label=\"Change split direction\"\n                  onClick={toggleSplitDirection}\n                  icon={faColumns}\n                  text={`Split mode: ${interpreterSplitDirection}`}\n                />\n                { isInterpreterEnabled ?\n                    <DropDownItem\n                      label=\"Toggle editor\"\n                      onClick={() => toggleEditor(!isEditorEnabled)}\n                      icon={faCode}\n                      text={`${isEditorEnabled ? 'Hide' : 'Show' } editor`}\n                    /> : undefined\n                }\n                { isEditorEnabled ?\n                  <DropDownItem\n                    label=\"Toggle interpreter\"\n                    onClick={() => toggleInterpreter(!isInterpreterEnabled)}\n                    icon={faEye}\n                    text={`${isInterpreterEnabled ? 'Hide' : 'Show' } interpreter`}\n                  /> : undefined\n                }\n\n                <DropDownItem\n                  label=\"Editor preferences\"\n                  onClick={openEditorSettings}\n                  icon={faSlidersH}\n                  text=\"Editor preferences\"\n                />\n              </DropDownMenu>\n             ) : ''\n           }\n         </IconWrapper>\n        </Header>\n       <SplitPane\n         direction={interpreterSplitDirection}\n         defaultSizes={[50, 50]}\n         style={{height: 'calc(100% - 40px)'}}\n         aria-label=\"Main panels\">\n        { isEditorEnabled ?\n          <Editor\n              defaultValue={editorDefaultValue}\n              setDocumentContent={setDocumentContent}\n              notifyChange={addDialogueLine}\n              preferences={editorPreferences}\n           /> : undefined }\n        { isInterpreterEnabled ?\n           <Interpreter\n             content={editorDefaultValue}\n             currentBlock={currentBlock}\n             timeline={timeline}\n             shouldShowExtraMetadata={shouldShowExtraMetadata}\n             shouldShowDebugPane={shouldShowDebugPane}\n             singleBubblePresentation={singleBubblePresentation}\n             clydeDocument={clydeDocument}\n             setBlock={setBlock}\n             addDialogueLine={addDialogueLine}\n             clearTimeline={clearTimeline}\n             showExtraMetadata={showExtraMetadata}\n             hideExtraMetadata={hideExtraMetadata}\n             showDebugPane={showDebugPane}\n             hideDebugPane={hideDebugPane}\n             enableSingleBubbleDialogue={enableSingleBubbleDialogue}\n             disableSingleBubbleDialogue={disableSingleBubbleDialogue}\n             chooseOption={chooseOption}\n             events={events}\n             notifyEvent={notifyEvent}\n             clearEvents={clearEvents}\n         />: undefined }\n       </SplitPane>\n      { isEditorSettingsVisible ?\n        <EditorSettingsModal updatePreference={updateEditorPreference} preferences={editorPreferences} onCloseClick={() => setEditorSettingsVisibility(false)} />\n      : undefined }\n    </Wrapper>\n  );\n};\n\nMainPanels.propTypes = {\n  isEditorEnabled: PropTypes.bool,\n  isInterpreterEnabled: PropTypes.bool,\n  toggleProjectTree: PropTypes.func,\n  toggleEditor: PropTypes.func,\n  toggleInterpreter: PropTypes.func,\n  interpreterSplitDirection: PropTypes.string,\n  editorDefaultValue: PropTypes.string,\n  setDocumentContent: PropTypes.func,\n\n  currentBlock: PropTypes.string,\n  timeline: PropTypes.array,\n  shouldShowExtraMetadata: PropTypes.bool,\n  shouldShowDebugPane: PropTypes.bool,\n  singleBubblePresentation: PropTypes.bool,\n  clydeDocument: PropTypes.string,\n\n  setBlock: PropTypes.func,\n  addDialogueLine: PropTypes.func,\n  clearTimeline: PropTypes.func,\n  showExtraMetadata: PropTypes.func,\n  hideExtraMetadata: PropTypes.func,\n  showDebugPane: PropTypes.func,\n  hideDebugPane: PropTypes.func,\n  enableSingleBubbleDialogue: PropTypes.func,\n  disableSingleBubbleDialogue: PropTypes.func,\n\n  notifyEvent: PropTypes.func,\n  clearEvents: PropTypes.func,\n};\n\n","import { connect } from 'react-redux';\n\nimport MainPanels from './MainPanels';\n\nimport {\n  toggleEditor,\n  toggleInterpreter,\n  changeInterpreterSplitDirection\n} from '../redux/interface';\n\nimport {\n  setBlock,\n  addDialogueLine,\n  clearTimeline,\n  showExtraMetadata,\n  hideExtraMetadata,\n  showDebugPane,\n  hideDebugPane,\n  enableSingleBubbleDialogue,\n  disableSingleBubbleDialogue,\n  chooseOption,\n  notifyEvent,\n  clearEvents,\n} from '../redux/interpreter';\n\nimport {\n  setDocumentContent,\n  updatePreference\n} from '../redux/editor';\n\nconst mapStateToProps = (state, props) => ({\n  ...state.interfaceConfig,\n  editorDefaultValue: state.editor.currentValue,\n  editorPreferences: state.editor.preferences,\n  ...state.interpreter,\n  ...props\n});\n\nconst mapDispatchToProps = dispatch => ({\n  toggleEditor: (state) => {\n    dispatch(toggleEditor({state}));\n  },\n  toggleInterpreter: (state) => {\n    dispatch(toggleInterpreter({state}));\n  },\n  changeInterpreterSplitDirection: (direction) => {\n    dispatch(changeInterpreterSplitDirection({direction}));\n  },\n  setBlock: (blockName) => {\n    dispatch(setBlock(blockName));\n  },\n  addDialogueLine: (line) => {\n    dispatch(addDialogueLine(line));\n  },\n  clearTimeline: () => {\n    dispatch(clearTimeline());\n  },\n  showExtraMetadata: () => {\n    dispatch(showExtraMetadata());\n  },\n  hideExtraMetadata: () => {\n    dispatch(hideExtraMetadata());\n  },\n  showDebugPane: () => {\n    dispatch(showDebugPane());\n  },\n  hideDebugPane: () => {\n    dispatch(hideDebugPane());\n  },\n  enableSingleBubbleDialogue: () => {\n    dispatch(enableSingleBubbleDialogue());\n  },\n  disableSingleBubbleDialogue: () => {\n    dispatch(disableSingleBubbleDialogue());\n  },\n  chooseOption: (optionIndex) => {\n    dispatch(chooseOption(optionIndex));\n  },\n  setDocumentContent: (content) => {\n    dispatch(setDocumentContent(content));\n  },\n  notifyEvent: (event) => {\n    dispatch(notifyEvent(event));\n  },\n  clearEvents: () => {\n    dispatch(clearEvents());\n  },\n  updateEditorPreference: (name, value) => {\n    dispatch(updatePreference({ name, value }));\n  },\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(MainPanels);\n\n","export const APP_LOCAL_STORAGE_KEY = 'clyde_editor_data';\n\nexport const saveState =(state) => {\n  try {\n    localStorage.setItem(APP_LOCAL_STORAGE_KEY, JSON.stringify(state));\n  } catch (_e) {\n  }\n};\n\nexport const loadState = () => {\n  try {\n    const persistedSate = localStorage.getItem(APP_LOCAL_STORAGE_KEY);\n    if (persistedSate === null) {\n      return undefined;\n    }\n    return JSON.parse(persistedSate);\n  } catch (_e) {\n    return undefined;\n  }\n};\n\nexport const clearState = () => {\n  try {\n    localStorage.removeItem(APP_LOCAL_STORAGE_KEY);\n  } catch (_e) {\n  }\n}\n","import { configureStore } from '@reduxjs/toolkit'\nimport { Provider } from 'react-redux';\n\nimport throttle from 'lodash/throttle';\n\nimport reducer from './redux/reducers';\nimport MainPanelsContainer from './screens/MainPanelsContainer';\n\nimport { createEmptyState as createEmptyEditorState } from './redux/editor';\nimport { loadState, saveState } from './storage/local-storage';\n\nconst EDITOR_DEFAULT_VALUE = `--\n--\n-- This is a sample dialogue.\n--\n\nNarrator: Hello there!\nPlayer: Hi!\nNarrator: What do you want to talk about?\n  + Life\n    -> about life <-\n  + The universe\n    -> about the universe <-\n  * Everything else... #some_tag\n    -> about everything else <-\n  + Earth\n    -> about earth <-\n  + Nothing\n    -> goodbye <-\n\n\n== about life\nPlayer: I want to talk about life!\nNarrator: Well! That's complicated...\n<-\n\n\n== about the universe\nPlayer: I want to talk about the universe!\n( shuffle\n  - Narrator: That's too complex!\n  - Narrator: Maybe another time.\n  - Narrator: It's big...\n              I think that's all.\n)\n<-\n\n\n== about everything else\nPlayer: What about everything else?\nNarrator: I don't have time for this... #bored\n<-\n\n== about earth\nPlayer: What do you know about earth?\n( sequence\n - Narrator: It's mostly harmless.\n - Narrator: This again?\n             I've already told you, mostly harmless.\n -\n   Narrator: Why do you want to know so much about it?\n   Player: I don't know...\n   Narrator: So.. don't ask!\n\n - Narrator: I'm not talking about this anymore.\n)\n<-\n\n== goodbye\n{ not alreadyIntroduced }\n  Narrator: It was nice to meet you!\n  Player: I can say the same. See you around!\n  { set alreadyIntroduced = true }\nPlayer: Bye!\nNarrator: Good bye!\n`;\n\n\nconst load = () => {\n  const data = loadState() || { editor: createEmptyEditorState() };\n\n  if (!data.editor.currentValue) {\n    data.editor.currentValue = EDITOR_DEFAULT_VALUE;\n  }\n\n  return {\n    editor: data.editor,\n    interpreter: {\n      document: undefined,\n      events: [],\n      timeline: [],\n      ...data.interpreter\n    }\n  };\n};\n\nconst store = configureStore({\n  reducer,\n  devTools: process.env.NODE_ENV !== 'production',\n  preloadedState: load(),\n});\n\nstore.subscribe(throttle(() => {\n  const state = store.getState();\n  const {\n    shouldShowExtraMetadata,\n    shouldShowDebugPane,\n    debugPaneDirection,\n    singleBubblePresentation,\n  } = state.interpreter;\n\n  saveState({\n    editor: {\n      preferences: state.editor.preferences,\n      currentValue: state.editor.currentValue\n    },\n    interpreter: {\n      shouldShowExtraMetadata,\n      shouldShowDebugPane,\n      debugPaneDirection,\n      singleBubblePresentation,\n    },\n  });\n}, 1000));\n\n\nfunction App() {\n  return (\n    <Provider store={store}>\n      <MainPanelsContainer />\n    </Provider>\n  );\n}\n\nexport default App;\n","import App from './App';\n\nimport styled from 'styled-components';\n\nconst Wrapper = styled.div`\n  height: 100%;\n  max-height: 100vh;\n  max-width: 1200px;\n  display: flex;\n  flex-direction: column;\n  padding: 10px 5px;\n  margin: 0 auto;\n`;\n\nconst Title = styled.h1`\n  font-size: 2em;\n  font-weight: 500;\n`;\n\nconst AboutBlock = styled.div`\n  font-family: 'Lato', sans-serif;\n  margin: 10px 40px;\n  p {\n    margin-bottom: 10px;\n  }\n\n  a {\n    margin: 5px 10px;\n  }\n`;\n\nconst AboutContent = styled.div`\n  margin-top: 30px;\n`;\n\nexport default function WebsiteApp() {\n  return (\n    <Wrapper>\n      <AboutBlock>\n        <Title>Clyde Dialogue Language</Title>\n        <AboutContent>\n          <p>\n            Clyde is a language for writing dialogues.\n            <a href=\"https://github.com/viniciusgerevini/clyde\">Github</a>\n            <a href=\"https://github.com/viniciusgerevini/clyde/blob/master/LANGUAGE.md\">Language Docs</a>\n            <a href=\"https://github.com/viniciusgerevini/clyde/tree/master/cli\">CLI</a>\n            <a href=\"https://github.com/viniciusgerevini/godot-clyde-dialogue\">Godot Plugin</a>\n          </p>\n        </AboutContent>\n\n      </AboutBlock>\n        <App/>\n    </Wrapper>\n  );\n}\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './styles/reset.css';\nimport './index.css';\n// import App from './App';\nimport App from './WebsiteApp';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App/>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}